% Template for PLoS
% Version 3.5 March 2018
%
% % % % % % % % % % % % % % % % % % % % % %
%
% -- IMPORTANT NOTE
%
% This template contains comments intended 
% to minimize problems and delays during our production 
% process. Please follow the template instructions
% whenever possible.
%
% % % % % % % % % % % % % % % % % % % % % % % 
%
% Once your paper is accepted for publication, 
% PLEASE REMOVE ALL TRACKED CHANGES in this file 
% and leave only the final text of your manuscript. 
% PLOS recommends the use of latexdiff to track changes during review, as this will help to maintain a clean tex file.
% Visit https://www.ctan.org/pkg/latexdiff?lang=en for info or contact us at latex@plos.org.
%
%
% There are no restrictions on package use within the LaTeX files except that 
% no packages listed in the template may be deleted.
%
% Please do not include colors or graphics in the text.
%
% The manuscript LaTeX source should be contained within a single file (do not use \input, \externaldocument, or similar commands).
%
% % % % % % % % % % % % % % % % % % % % % % %
%
% -- FIGURES AND TABLES
%
% Please include tables/figure captions directly after the paragraph where they are first cited in the text.
%
% DO NOT INCLUDE GRAPHICS IN YOUR MANUSCRIPT
% - Figures should be up\textit{loaded} separately from your manuscript file. 
% - Figures generated using LaTeX should be extracted and removed from the PDF before submission. 
% - Figures containing multiple panels/subfigures must be combined into one image file before submission.
% For figure citations, please use "Fig" instead of "Figure".
% See http://journals.plos.org/plosone/s/figures for PLOS figure guidelines.
%
% Tables should be cell-based and may not contain:
% - spacing/line breaks within cells to alter layout or alignment
% - do not nest tabular environments (no tabular environments within tabular environments)
% - no graphics or colored text (cell background color/shading OK)
% See http://journals.plos.org/plosone/s/tables for table guidelines.
%
% For tables that exceed the width of the text column, use the adjustwidth environment as illustrated in the example table in text below.
%
% % % % % % % % % % % % % % % % % % % % % % % %
%
% -- EQUATIONS, MATH SYMBOLS, SUBSCRIPTS, AND SUPERSCRIPTS
%
% IMPORTANT
% Below are a few tips to help format your equations and other special characters according to our specifications. For more tips to help reduce the possibility of formatting errors during conversion, please see our LaTeX guidelines at http://journals.plos.org/plosone/s/latex
%
% For inline equations, please be sure to include all portions of an equation in the math environment.  For example, x$^2$ is incorrect; this should be formatted as $x^2$ (or $\mathrm{x}^2$ if the romanized font is desired).
%
% Do not include text that is not math in the math environment. For example, CO2 should be written as CO\textsubscript{2} instead of CO$_2$.
%
% Please add line breaks to long display equations when possible in order to fit size of the column. 
%
% For inline equations, please do not include punctuation (commas, etc) within the math environment unless this is part of the equation.
%
% When adding superscript or subscripts outside of brackets/braces, please group using {}.  For example, change "[U(D,E,\gamma)]^2" to "{[U(D,E,\gamma)]}^2". 
%
% Do not use \cal for caligraphic font.  Instead, use \mathcal{}
%
% % % % % % % % % % % % % % % % % % % % % % % % 
%
% Please contact latex@plos.org with any questions.
%
% % % % % % % % % % % % % % % % % % % % % % % %

\documentclass[10pt,letterpaper]{article}
\usepackage[top=0.85in,left=2.75in,footskip=0.75in]{geometry}

% customized packages
\usepackage{fixltx2e}
\usepackage{stfloats}
\usepackage{subfloat}
\usepackage[caption=false,font=footnotesize]{subfig}

% amsmath and amssymb packages, useful for mathematical formulas and symbols
\usepackage{amsmath,amssymb}
% algorithm,algorithmicx,algpseudocode are used for writing pseudo code and algorithms
\usepackage{algorithm,algorithmicx,algpseudocode}
% multirow is used for adjusting the table
\usepackage{multirow}
% Use adjustwidth environment to exceed column width (see example table in text)
\usepackage{changepage}

% Use Unicode characters when possible
\usepackage[utf8x]{inputenc}

% textcomp package and marvosym package for additional characters
\usepackage{textcomp,marvosym}

% cite package, to clean up citations in the main text. Do not remove.
\usepackage{cite}

% Use nameref to cite supporting information files (see Supporting Information section for more info)
\usepackage{nameref,hyperref}

% line numbers
\usepackage[right]{lineno}

% ligatures disabled
\usepackage{microtype}
\DisableLigatures[f]{encoding = *, family = * }

% color can be used to apply background shading to table cells only
\usepackage[table]{xcolor}
\usepackage{booktabs}
% stop disconnecting vertical lines:
\setlength{\aboverulesep}{0ex}
\setlength{\belowrulesep}{0ex}
% array package and thick rules for tables
\usepackage{array}

% create "+" rule type for thick vertical lines
\newcolumntype{+}{!{\vrule width 2pt}}

% create \thickcline for thick horizontal lines of variable length
\newlength\savedwidth
\newcommand\thickcline[1]{%
  \noalign{\global\savedwidth\arrayrulewidth\global\arrayrulewidth 2pt}%
  \cline{#1}%
  \noalign{\vskip\arrayrulewidth}%
  \noalign{\global\arrayrulewidth\savedwidth}%
}

% \thickhline command for thick horizontal lines that span the table
\newcommand\thickhline{\noalign{\global\savedwidth\arrayrulewidth\global\arrayrulewidth 2pt}%
\hline
\noalign{\global\arrayrulewidth\savedwidth}}


% Remove comment for double spacing
%\usepackage{setspace} 
%\doublespacing

% Text layout
\raggedright
\setlength{\parindent}{0.5cm}
\textwidth 5.25in 
\textheight 8.75in

% Bold the 'Figure #' in the caption and separate it from the title/caption with a period
% Captions will be left justified
\usepackage[aboveskip=1pt,labelfont=bf,labelsep=period,justification=raggedright,singlelinecheck=off]{caption}
\renewcommand{\figurename}{Fig}

% Use the PLoS provided BiBTeX style
\bibliographystyle{plos2015}

% Remove brackets from numbering in List of References
\makeatletter
\renewcommand{\@biblabel}[1]{\quad#1.}
\makeatother



% Header and Footer with logo
\usepackage{lastpage,fancyhdr,graphicx}
\usepackage{epstopdf}
\graphicspath{{./Figures/}}
%\pagestyle{myheadings}
\pagestyle{fancy}
\fancyhf{}
%\setlength{\headheight}{27.023pt}
%\lhead{\includegraphics[width=2.0in]{PLOS-submission.eps}}
\rfoot{\thepage/\pageref{LastPage}}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrule}{\hrule height 2pt \vspace{2mm}}
\fancyheadoffset[L]{2.25in}
\fancyfootoffset[L]{2.25in}
\lfoot{\today}

%% Include all macros below

\newcommand{\lorem}{{\bf LOREM}}
\newcommand{\ipsum}{{\bf IPSUM}}

%% END MACROS SECTION


\begin{document}
\vspace*{0.2in}

% Title must be 250 characters or less.
\begin{flushleft}
{\Large
\textbf\newline{{Simulation Based Biarticular and Monoarticular Exsokeletons Design, Analysis, and Comparison}} % Please use "sentence case" for title and headings (capitalize only the first word in a title (or heading), the first word in a subtitle (or subheading), and any proper nouns).
}
\newline
% Insert author names, affiliations and corresponding author email (do not include titles, positions, or degrees).
\\
Ali KhalilianMotamed Bonab\textsuperscript{1*},
Volkan Patoglu\textsuperscript{1}
\\
\bigskip
\textbf{1} Human Machine Interaction Laboratory, Mechatronics Engineering, Faculty of Engineering and Natural Science, Sabanci University, Istanbul, Turkey.
\\
\bigskip

% Use the asterisk to denote corresponding authorship and provide email address in note below.
* alik/vpatoglu@sabanciuniv.edu

\end{flushleft}
% Please keep the abstract below 300 words
\section*{Abstract}

% Use "Eq" instead of "Equation" for equation citations.
\section*{Introduction}
The versatility and bipedalism of human locomotion are both unique\cite{1} and the most important characteristics of humans among the mammalian mobility types. While bipedal locomotion has a low energy cost of transport\cite{1}, the human versatile musculoskeletal system is not perfectly appropriate for performing all the tasks \cite{2}. For instance, among all movement tasks, two important tasks for human locomotion are running and walking, and it has been proven that running is considerably less efficient than walking \cite{3,4}.\\
Bipedal locomotion can also lose its efficiency through aging, disease and injury, which can profoundly affect the quality of life \cite{7} due to a loss of independence and mobility. It has been shown that static and dynamic strength \cite{8,9,10}, force development rate \cite{11,12}, prolongation of twitch contraction\cite{9,13}, and passive stiffness\cite{14,15} of the healthy elderly people's muscles have been remarkably changed compared to those of young, healthy people and consequence of these changes is the weakening the performance of gait \cite{16}.\\
Along with aging, disease and injury are other primary causes of inefficient human locomotion . One of the most important injuries is spinal cord injuries (SCI), which considerably affect the human ability to perform movement tasks \cite{17}. Among all possible diseases causing gait variability, a hemiparetic walking is one of the most and major issues patients face after stroke \cite{18,19,20,21}. A stroke can have a serious effect on motor cells and pathways of the central nervous system \cite{19} which can remain after stroke for a long time, restricting patients from reaching normal speed, safe and economical gait\cite{22}; leading to inability on generating desired muscle contraction\cite{19}, and generally impaired muscular control\cite{23}. Loss of muscle strength\cite{24}, reduced ankle dorsiflexion, and knee flexion \cite{25,26} are some typical effects of stoke leading to a high cost of transportation on the patient.\\

Even though in the long term, training can improve the efficiency of locomotion\cite{5} by increasing the stiffness of the tendons \cite{6}, and rehabilitation can help patients to achieve near-normal locomotion \cite{22},the muscle and tendon tissues fundamentally constrain the dynamic properties of the muscles and musculoskeletal system compromises between enhancing the efficiency of the desired task and its adaptability\cite{2}, and persistence of the neuromotor deficits even after the rehabilitation constrains \cite{22} the patients from completely resolving the gait issues and reaching complete independence.\\
By taking advantage of assistive devices not bounded by any fundamental biological limitations, a musculotendon system can be customized to increase the efficiency of performing the desired task while degrading versatility. It can be used for patients to improve their quality of life by modifying their abnormal gait pattern and decreasing their dependency; assistive devices  can also be employed to reduce the risk of injuries for tasks needed to carry heavy loads \cite{27,28,29}.\\
\subsection*{Lower Limb Exoskeletons}
%TODO: This section seems to short. We may revise this part.
The first efforts to develop mobile powered exoskeletons were initiated in1890 \cite{30}. Despite efforts and progress in accomplishing untethered exoskeleton over a century\cite{31}, in 2000 Defense Advanced Research Projects Agency (DARPA) initiated the Exoskeletons for Human Performance Augmentation (EHPA) Program\cite{32}, and the first mobile and functional exoskeleton, named Berkeley Lower Extremity Exoskeleton (BLEEX) was developed to augment soldiers' capability of carrying heavy loads over long distances\cite{33}. Sarcos and MIT exoskeletons were introduced\cite{30} after BLEEX as untethered exoskeletons. The same technology with the purpose of assisting impaired populations also was already initiated\cite{34}, and ReWalk is one of the well-known exoskeletons \cite{35} which has recently been approved by FDA \cite{36}. The Hybrid Assistive Limbs (HAL) project\cite{37} is another notable project assisting SCI, stroke, and other patients suffering from impaired bipedal walking. Reviews on exoskeletons, prostheses ,and orthoses are available in the literature\cite{31,36,37,38,39}.\\

The main objective of assistive devices is reducing the metabolic cost of locomotion and, in particular, decreasing the metabolic energy required for running and walking tasks. Although efforts on designing active exoskeletons to reach this goal were initiated decades ago, the researchers have only recently succeeded in accomplishing this goal \cite{40}, which was a tethered device assisting ankle and  $6 \pm 2$\% metabolic cost reduction was reportedly achieved by the ankle exoskeleton. After this exoskeleton, Mooney et al. \cite{41} and Collins et al. \cite{42} reported the reduction of metabolic energy consumption using their ankle exoskeletons. Recently, many exoskeletons and exosuits research groups have reported metabolic cost reduction; a Harvard research group \cite{43} achieved a $32 \pm 9$\% metabolic burden reduction in post-stroke walking using a tethered exosuit which is one of the notable performance among the performance of exoskeletons developed recently.

\subsection*{Biarticular Actuation}
%TODO: There is a new review paper on this subject, we may update this section
Despite the developments in recent years, a number of challenges need to be surmounted to achieve high metabolic cost reduction to assist people more economically. One of the remarkable challenges on designing an efficient exoskeleton is mass minimization\cite{41,44,45} and more importantly, minimizing distal masses \cite{45} has a significant effect on exoskeleton efficiency since adding any mass to the distal extremity will increase the metabolic cost of the locomotion \cite{45} and walking pattern \cite{44}. To address this challenge, using passive exoskeletons without any actuation and power supply module has been proposed; although the metabolic cost reduction is low, they are lightweight assistive devices\cite{42,46}. An alternative solution is using tethered exoskeletons in which any heavy component is grounded, and actuation is off-board\cite{40,47}. However, these tethered exoskeletons restrict the mobility of the exoskeleton, and experimental results have been limited to lab-based scenarios.\\

It has been proven that human bipedal movement is an economical locomotion \cite{1,48} for various terrains \cite{1,49} and long distances \cite{50}. It thus inspiration for designing efficient mobile exoskeletons not only to solve the distal mass and inertia problem but also to provide some additional advantages on the exoskeleton design such as lower power consumption. One of the main reasons for human bipedal locomotion efficiency is the presence of specific muscles, biarticular muscles \cite{51,52,53}, which have several unique and notable roles on human locomotion.\\
A human lower limb has more muscles than is needed to actuate each degree of freedom(DOF) \cite{53} which means that human lower extremity is redundantly actuated, consisting of monoarticular muscles, which is a type of muscles spanning a joint, and another type span two joints known as biarticular muscles. Although the biarticular muscles, i.e. muscles span two joints, are not necessary for performing movements, they have not been eliminated from the human muscular system during human musculoskeletal system evolution, indicating their advantage for human locomotion \cite{53}. Moreover, the motor control system selects certain muscles to accomplish specific tasks\cite{54}, and the metabolic energy consumption is one of the main factors to select muscles to need to be activated among the muscles of desired degrees of freedom \cite{53}. The significance of the biarticular muscles in the energy economy of locomotion has been proven by several computational analyses\cite{55,56} studying biarticular muscle activation during movement.\\

The effect of biarticular muscles on locomotion and their benefits have been discussed in multiple studies \cite{51,53,57,63}. One of the key benefits of biarticular muscles is transporting energy from proximal to distal joints produced by monoarticular muscles \cite{51,58,59,60,61,62}; studies on jumping, which is a high power demanding task, revealed that energy produced by monoarticular muscles at each joint is not sufficient to produce a high jump\cite{58}, and energy transportation is necessary to meet the power requirement\cite{58}. Moreover, this proximal to distal energy flow allows for the distribution of the muscles weight, resulting in lower leg inertia \cite{62} which inherently requires less energy to be actuated, leading to more economical locomotion\cite{62,53}. Elftman\cite{64} also claimed, by studying the running task, that presence of biarticular muscles can regenerate the negative work in phases of running in which adjacent joints have opposite power signs resulting in more economical movement \cite{65} which was confirmed by \cite{66} for walking and jumping as well. \\
Another central role of biarticular muscles is facilitating the coupling of joint movement \cite{53,57}; thereby allowing control of the distal joint. For instance, if two joints are coupled with a stiff biarticular muscle, displacement of a joint will cause the movement of another joint as well due to biarticular muscle origin movement\cite{57}. This phenomenon is called ligamentous action \cite{67} which permits the location of most of the monoarticular muscles away from the distal joint and indirectly control them\cite{57}; similar to the energy transportation feature of biarticular muscles, this characteristic of biarticular muscle leads to lower inertia leg \cite{57,67} which can decrease the metabolic cost of locomotion.\\
The third remarkable benefit of biarticular muscles is controlling output force direction, which enables to get optimal output power. It has been shown that while most of the work is generated by monoarticular muscles, their output force direction is not optimal\cite{53}. Biarticular muscles are responsible for controlling output force direction\cite{53}, which must align with velocity to reach maximum output power\cite{53}. It has also been proven that biarticular muscles have lower contraction velocity than monoarticular muscles \cite{57}, resulting in the muscles having concurrent movements \cite{68}, and therefore higher muscle force compared to uniarticular muscles\cite{53}. \\
Biarticular muscle effect on limb stiffness has been studied by several researchers\cite{69,70}; one of the key findings is that loss of stiffness produced by biarticular muscles cannot be compensated by monoarticular muscle stiffness\cite{69,70}. These studies revealed that the presence of multi-joint muscles would dramatically increase the central nervous system ability to modulate endpoint stiffness \cite{70,71}. Additionally, biarticular muscle provides necessary coupling to regulate inter-limb interaction\cite{72}, and the absence of them would lead to elongated stiffness ellipse, reduce maximum achievable stiffness, and finally limit orientation range\cite{69}.
The stability effect of biarticular muscles is another role that has been studied \cite{73,74,76}. J. McIntyre et al. \cite{73} proved that the presence of biarticular muscles is necessary to provide a coupling enabling passive control of neuro-musculoskeletal system stability.\\

Considering all these advantages and roles of biarticular muscles in human locomotion, it has inspired the robotics field researchers to adapt their designs to take advantage of biarticular biological features\cite{53}. Several actuators \cite{77,78}, bipedal robots\cite{74,75,76} ,and assistive devices\cite{53} have been designed based on multi-articular muscles configuration.
The biarticular component has been used in designing several prostheses trying to mimic gastrocnemius muscle to reduce the actuators energy consumption\cite{82,83,84,86,87} where results represent a promising improvement on the efficiency of prostheses\cite{87}. Several exoskeletons and exosuits are developed also to assist two joints simultaneously\cite{43,47,49,79,80,81}. Asbeck et al\cite{47} developed a soft exosuit assisting hip and ankle joints using the multi-articular concept on their design and reported 21\% to 19\% nominal metabolic cost reduction. Another noteworthy soft biarticular exosuit that has been designed for after stroke rehabilitation shows 32\% metabolic cost reduction\cite{43}. Quinlivan et al. \cite{80}  developed tethered multi-articular soft exosuit, which demonstrated 23\% of metabolic burden reduction relative to powered of condition on healthy subject walking. Recently, Xiong et al. \cite{88} proposed a multi-articular passive exoskeleton assisting hip and knee inspired by energy transportation feature of biarticular muscles where it stores negative mechanical work of knee joint and uses to assist hip extension, they succeeded to reduce the metabolic energy consumption by 7.6\% without using any actuation module.\\
\subsection*{Simulation based Analysis of Assistive Devices}
Despite all these remarkable progress that have been made on designing exoskeletons and exosuits assisting elderly and disabled subjects suffering impaired gait cycles and healthy individuals, there are remarkable challenges with experimental based studies and designing of exoskeletons. Human in the loop studies always introduce several challenges on interaction with a human, From the establishing experiments perspective, some of the challenges are providing subject-specific prototypes, recruiting appropriate volunteers, guaranteeing their safety during the experiments, and attaining ethic approvals \cite{2}. From physical prototyping viewpoint, collecting information without implementing sensors inside the body in a limited time\cite{2}, difficulty or impossibility of some measurements\cite{89}, and training effect on subjects performance \cite{90,91} are some of the important challenges on human in the loop studies and designing procedures.\\
Simulation-based studies and designing assistive devices can complement the experimental design and analysis to overcome most of the challenges mentioned above. OpenSim is one of the software funded by NIH Roadmap grant U54 GM072970, the NIH research infrastructure grant R24 HD065690, and the DARPA Warrior Web Program and it has been used in movement science related fields\cite{89} and it is getting so attractive for researchers in robotics, biomedical engineering, biophysics, computer science and many other fields \cite{89,103}. Despite all the limitations on musculoskeletal modeling and simulation \cite{92}, OpenSim enables researchers by providing biomechanical models and simulation tools to investigate the human and animals movements \cite{89,103}. OpenSim has been used to design and study the assistive devices \cite{2,93,94,96}. Uchida et al. \cite{2} simulate several combinations of ideal assistive device on subjects running at 2 $m/s$ and 5 $m/s$ speeds and found that activity of muscles can be decreased even in the muscles that do not cross the assisted joints, and it can be increased in some muscles based on assistive device configuration; their simulation results confirmed and proposed clarification on some of the similar phenomena observed in experimental studies. Several ideal assistive devices effect on the metabolic cost of subjects carrying heavy loads has been studied by Dembia et al.\cite{93}, their study like Uchida et al. \cite{2} suggest the effective configurations and joints assist and give a perspective how an assistive device can change muscular activities of subjects carrying loads.\\
Recently, predictive simulations or simulation-based dynamic optimization approaches are emerging for studying assistive devices which can capture assistive devices effect on the musculoskeletal kinematics and kinetics \cite{112}. This approach has been used by V. Q. Nguyen et al. \cite{124} to study ankle exoskeleton effect on a normal speed walking subject where this approach enables them not only to study the exoskeleton effect on metabolic cost but also to investigate how the exoskeleton affects subject's kinematics and ground reaction forces. A novel active ankle powered prosthesis also was simulated and studied in predictive simulation framework by A. K. Lapre et al. \cite{125}. Predictive simulation has also been employed to simulate knee \cite{126} and ankle prostheses to investigate various control approaches on them\cite{111,127}. Moreover, Passive ankle prosthesis and Ankle-Foot orthosis stiffness has been optimized using this strategy \cite{128,129}.\\

\subsection*{Contributions}
In this study, we introduce a bio-inspired biarticular configuration of an exoskeleton assisting hip and knee joints and delivering torque to the knee joint distally.  We modeled the proposed exoskeleton through a musculoskeletal simulator framework and compared it to a typical monoarticular device that assists each joint directly by mounting an actuator to the joint. Modeling these exoskeletons through the musculoskeletal simulator framework provide us insight into not only the moment and power profiles of exoskeletons and their power consumption, but also the effect of these assistive devices on the muscle activity, energy expenditure, joint reaction forces, and stiffness of simulated subjects.\\
At the first stage of this investigation, the simulation-based study was conducted with ideal exoskeletons in which devices had no mass, inertia, or any limiting factor, and the actuators of these devices had no constraints on delivering torque to the joints. This type of simulations was employed to verify the purposed exoskeleton modeling on the musculoskeletal simulator and gain insight into the performance of these devices, and their effect on the assisted musculoskeletal models under ideal conditions.\\
This phase of the study showed that despite the same effect of both devices on the metabolic rates of subjects, the devices have different profiles and power consumptions. These simulations demonstrated that loading subjects with a heavy load mainly changes the profiles by magnitude and time-shifting, which depends on the toe-off time. It was also shown that the biarticular hip actuator has a more uniform work distribution in different load conditions, and it was less affected by loading subjects. Studying the muscular activities of the assisted subjects showed that the muscular activations of both assisted and unassisted degrees of freedom are also affected by augmenting ideal devices. Through the joint reaction loading analysis on this phase of simulations, it was observed that the assisted subjects have considerably different reaction loadings in all degrees of freedom of lower extremity, and interestingly, despite the same effect of devices on muscles and metabolic rates of assisted subjects, they have different impacts on the reaction loadings of the knee and patellofemoral joint.  Finally, the stiffness analysis showed that the assistive actuators have utterly different stiffness properties and impact on the stiffness of joints.\\

Although studying the exoskeletons without any restriction on their performance provides handy erudition about the exoskeletons, it is necessary to analyze and compare them in more realistic conditions that can be applied in real-time applications. Consequently, we organized another stage for this study in which we introduced a novel Pareto simulations framework to conduct reliable comparisons among different configurations of the exoskeletons in their optimal configurations by taking advantage of Pareto optimization and Pareto filtering methods and implementing them into the musculoskeletal framework. This designed method can provide average optimal trade-off cases for each configuration of the assistive devices based on the defined optimization objectives, which were defined as metabolic cost reduction and device power consumption as two optimization criteria in this study. The Pareto simulations and optimal devices resulting from this method can be employed to conduct fair comparisons, and it was used to study and compare the assistive devices with constraints on their maximum torque that can be provided to the joints to the joints.\\
Through this phase of the study, we showed that in both loading conditions, configurations exist for both devices that can provide the assistance of ideal exoskeletons with lower energy consumption. This finding implies that in order to conduct fair comparisons of different devices, performing Pareto simulations is inevitable. The second phase of the simulations with constrained devices revealed that although both devices have practically the same effect on the metabolic cost of subjects, the optimal configurations of these devices are considerably different and have different effects on the muscle activations of assisted subjects and the similarity between devices in ideal condition does not hold for constrained devices. Notwithstanding practically the same total metabolic rate, further analyzing and comparing the metabolic rate of each muscle showed that the effect of these devices on the trends and rates of some muscles differed throughout the optimal trade-off curve.\\
Analyzing the power consumption of optimal devices resulting from the second stage revealed that the devices have remarkably different actuator arrangements for delivering the same amount of assistance to the subjects. In the subsequent analysis of optimal devices, it was shown that both devices have considerably different moment and power profiles in comparison with each other and their ideal configurations. Additionally, it was revealed that the monoarticular exoskeleton has high variations within optimal devices and between load condition, which can considerably complicate the controlling of the device in different conditions. Studying the regeneratable power of the devices in different efficiency conditions and its effect on the overall performance of the device showed the essence and importance of designing a regeneration mechanism and battery. Through joint reaction force and stiffness analyses, it was demonstrated that constraining devices affect the loading of the joints and their stiffness, and that they do not resemble the loading and stiffness of joints assisted with ideal devices.\\
This study has been accomplished using OpenSim \cite{89}, which cannot simulate any dynamic variations without capturing their effect experimentally due to its neural control algorithm\cite{92}. To investigate the effect the inertial properties of optimal devices, obtained from the Pareto simulations, on the metabolic rate of assisted subjects, we adopted the model developed by Browning et al. \cite{45} and performed offline simulations to investigate the effect the inertial properties of optimal devices on the optimal trade-off curves of devices and assisted subjects' effort.
Additionally, we introduced a modified augmentation factor as a modification of the augmentation factor developed by Mooney et al. \cite{41} as a general exoskeleton performance metric framework. The augmentation factor was modified by combining the effect of inertia along with mass on the performance of devices, and it was used to study the efficiency of selected optimal devices obtained by Pareto simulations under consideration of their inertial properties.\\
The last stage of this study was a step in the direction of providing more realistic results from the simulations. This phase of the study revealed that the performance of devices is profoundly affected by their inertial properties; the effect was more severe for the monoarticular device due to its kinematic design. Analysis of optimal devices under the effect of their inertial properties using developed model, and the modified augmentation factor showed that most of the optimal biarticular exoskeletons were able to preserve their optimal performance under their mass and inertia effect. The ability of the biarticular devices on preserving its optimality under the effect of their inertial properties eases designing an optimal device. Unlike the biarticular exoskeleton, the developed model, along with the modified augmentation factor, showed that the optimality of monoarticular devices was profoundly altered by reflecting the effect of their inertial properties. To improve the performance of the monoarticular exoskeleton, we suggested two monoarticular designs different from its conventional design that can mitigate the effect of inertial properties of the device more effectively. Finally, the performance of the devices was analyzed under regeneration, revealing the promising effect of regeneration on the optimality of devices.\\

The paper is organized as follows: the Kinematic Modeling section presents the kinematics of the proposed biarticular and the monoarticular exoskeletons mechanism and explicates the relationship between these two assistive devices. The Musculoskeletal Simulation section begins by discussing the musculoskeletal model used for performing simulations in the Opensim framework, then explains the procedures of the simulations and analyses performed to obtain the studied criteria before discussing the modeling and simulation of assisted subjects. The Pareto simulation subsection is dedicated to explaining this method's workflow on the Opensim framework and the investigated objective on this phase of the study, followed by the Assistive Devices Inertial Properties Effect subsection organized to explain the developed metabolic model of adding mass and inertia and modified augmentation factor. Lastly, we discuss the validation of performed simulations, defined performance metrics, and present models and methods of statistical analyses which concludes the Musculoskeletal Simulation section.\\
The results and their discussions have been separated into three main subsection in the Results and Discussion section, including Ideal Exoskeleton Results, Pareto Simulation Results, and Optimal Devices Inertial Properties Effect subsections. The Ideal Exoskeleton Results subsection presents and discusses the results of simulations performed based on exoskeletons in ideal conditions without any constraints on their performance.Next, the Pareto Simulation Results discusses the optimal trade-off curves or Pareto front of simulated devices and conducts some comparisons between ideal and constrained devices along within and between constrained device comparisons. The Devices Inertial Properties Effect subsection discusses the effect of  inertial properties of devices and regeneration on optimal trade-off curves. The Results and Discussion section concludes by discussing the general shortcomings of simulation-based studies and the specific limitations of the study we conducted. Finally, the Conclusions and Future Work section concludes the paper.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Kinematic Modeling}
The biarticular exoskeleton was designed to assist hip and knee joints. The exoskeleton was inspired by the biarticular muscles and their functionality and the aim of the design was to keep the large portion of the device weight around the proximal joint (Hip) while delivering the required power to the distal joint (Knee). A parallelogram mechanism was purposed in the exoskeleton to accomplish this goal and take advantage of the biological features of biarticular muscles. The purposed assistive device is shown in Figure \ref{Fig_Exos_Kinematics_Model}\subref{Fig_Biarticular_Exo_Mechanism}.\\
\begin{figure*}[h!]
	\centering
	\subfloat[\small{biarticular device}]{\includegraphics[width=2in]{Cartoons/Biarticular_Exo_Mechanism.pdf}
		\label{Fig_Biarticular_Exo_Mechanism}}
	\hfil
	\subfloat[\small{monoarticular device}]{\includegraphics[width=2in]{Cartoons/Monoarticular_Exo_Mechanism.pdf}
		\label{Fig_Monoarticular_Exo_Mechanism}}
	\vspace{1mm}
	\caption{\small{\textbf{Assistive devices kinematics model.} The parallelogram mechanism has been used to model the biarticular exoskeleton and the monoarticular exoskeleton modeled by two link serial manipulator.}}
	\label{Fig_Exos_Kinematics_Model}
\end{figure*}
A monoarticular exoskeleton can be modeled as a two-link serial manipulator as shown in Figure \ref{Fig_Exos_Kinematics_Model}\subref{Fig_Monoarticular_Exo_Mechanism} in which each joint was assisted by the joint actuator directly. The kinematics modeling of the monoarticular and biarticular exoskeletons at both the configuration and motion levels is represented in \nameref{S1_Appendix}.\\
As can be interpreted from the kinematics of the exoskeletons represented in \nameref{S1_Appendix}, a linear mapping between monoarticular and biarticular exoskeletons can be established to relate these two devices through a linear Jacobian as is represented in Eqn \eqref{Eqn_Mono_Bi_Jacobian}.
\begin{equation}\label{Eqn_Mono_Bi_Jacobian}
\begin{aligned}
\omega_{2\times 1, \mathrm{monoarticular}} &= J_{2\times 2}\omega_{2\times 1, \mathrm{biarticular}}\\
\left\lbrack \begin{array}{c}
{}^{\mathrm{torso}} {\omega_{\mathrm{mono}} }^{\mathrm{femur}} \\
{}^{\mathrm{femur}} {\omega_{\mathrm{mono}} }^{\mathrm{tibia}} 
\end{array}\right\rbrack &=\left\lbrack \begin{array}{cc}
1 & 0\\
-1 & 1
\end{array}\right\rbrack \left\lbrack \begin{array}{c}
{}^{\mathrm{torso}} {\omega_{\mathrm{bi}} }^{\mathrm{femur}} \\
{}^{\mathrm{torso}} {\omega_{\mathrm{bi}} }^{\mathrm{tibia}} 
\end{array}\right\rbrack
\end{aligned}
\end{equation}
Using Eqn.\eqref{Eqn_Mono_Bi_Jacobian} which is a mapping between the angular velocities of the exoskeletons, we can derive the mapping between the torque provided by exoskeletons as shown in Eqn. \eqref{Mono_Bi_Torque_Mapping}.
\begin{equation}\label{Mono_Bi_Torque_Mapping}
\begin{aligned}
\tau_{2\times 1,\;\mathrm{biarticular}} &=J^T \tau_{2\times 1,\;\mathrm{monoarticular}}\\
\left\lbrack \begin{array}{c}
{\tau^{\mathrm{torso}/\mathrm{femur}} }_{\mathrm{bi}} \\
{\tau^{\mathrm{torso}/\mathrm{tibia}} }_{\mathrm{bi}} 
\end{array}\right\rbrack &={\left\lbrack \begin{array}{cc}
	1 & 0\\
	-1 & 1
	\end{array}\right\rbrack }^T \left\lbrack \begin{array}{c}
{\tau^{\mathrm{torso}/\mathrm{femur}} }_{\mathrm{mono}} \\
{\tau^{\mathrm{femur}/\mathrm{tibia}} }_{\mathrm{mono}} 
\end{array}\right\rbrack\\
\end{aligned}
\end{equation}
This relation between two exoskeleton was used to verify the modeling of the exoskeleton through a musculoskeletal simulation framework.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Musculoskeletal Simulation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Musculoskeletal Model}
The exoskeletons were studied through musculoskeletal simulations by conducting the simulations of seven subjects walking normally and while carrying a 38 kg load on the torso at their chosen speed. The data used in this study was experimentally collected and processed by Dembia et.al. \cite{93} and their experimental protocol was approved by the Stanford University Institutional Review Board \cite{93}.\\
The musculoskeletal model used in the simulations, which was the same as the model used by Dembia et al. \cite{93}, was a three-dimensional model developed by Rajagopal et al. \cite{130} with 39 degrees of freedom in which the lower limbs were actuated using 80 massless musculotendon actuators, and the upper limb was actuated by 17 torque actuators\cite{130}. \\
This three-dimensional musculoskeletal model was adapted by locking some unnecessary degrees of freedom for both normal walking and walking with a heavy load scenarios and modeling the extra load on the torso of the musculoskeletal model for the walking with heavy load condition \cite{93}.\\
Since this research was built upon the study performed by Dembia et al., we followed similar terminologies in most of the cases to avoid any confusion. Therefore, the \textit{loaded} condition refers to subjects walking while carrying a 38 kg load on their torso while the \textit{noload} condition references subjects walking without any extra load at their chosen speed.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Simulation Procedure}
The first step of conducting the simulations for each subject is scaling the generic dynamic model to acquire a musculoskeletal model matching the anthropometry of each subject, which was performed using OpenSim Scale Tool, and the maximum isometric forces of the muscles were scaled according to the mass and height of each subject \cite{93}. After obtaining the scaled model for each subject, the inverse kinematics for each subject was computed using OpenSim Inverse Kinematics Tool and the motion capture data collected experimentally to obtain the angle trajectories of joints.\\
At the next stage of the simulation workflow, the scaled model, inverse kinematics, and ground reaction forces were employed to run the RRA algorithm\cite{103}. The RRA algorithm reduces the incompatibility of experimental data, including ground reaction forces and trace data, and the musculoskeletal model by slightly adjusting inertial properties and kinematics of the simulated subject. The adjusted model and kinematics generated by RRA were then employed to perform muscle driven simulations using a computed muscle control algorithm in OpenSim\cite{104}.\\
The computed muscle control (CMC) algorithm simulates the muscle recruitment of the subject by resolving the muscle redundancy problem using static optimization to find the required muscle excitations to track the adjusted kinematics. The CMC simulation output was then used to run the Analysis Tool of OpenSim to compute the metabolic power consumption, muscle moments, and joint reaction forces of the subject.\\
\begin{figure*}[ht]
	\includegraphics[width=\linewidth]{Cartoons/OpenSim.pdf} 
	\vspace{-5mm}
	\caption{\small{\textbf{Opensim simulation procedure block diagram.} The workflow of the simulation in OpenSim has been shown briefly in which green blocks stands for output, blue blocks are OpenSim simulations or analyses, purple blocks are models that have been used for simulations and analyses, and finally, red blocks represent processed experimental data.}}
	\label{Fig_OpenSim_Sim_Procedure}
\end{figure*}
The OpenSim computed muscles control algorithm solves the muscle redundancy problem to track experimentally measured motion using effort-based objective, as represented in Eqn.\eqref{Eqn_CMC_Objective}. This objective function was optimized to obtain a set of muscle excitations to track measured motions and forces within a specified tolerance at each time step during the motion of interest using a static optimization method\cite{92}. Therefore, the kinematics and dynamics of the subject remain consistent during the simulations, and any additional mass and inertia on the subject that has not been captured by experiments cause a systematic error in the results.\\
\begin{equation}\label{Eqn_CMC_Objective}
J = \sum_{i\in nMuscles} a_{i}^{2} + \sum_{i \in nReserves} (\frac{\tau_{r,i}}{w_{r,i}})^2
\end{equation}
With the knowledge of the OpenSim neural control algorithm, we used the adjusted model and kinematics provided by Dembia et al.\cite{93} instead of reproducing all data from the beginning of the simulation procedure, which also helped ease the verification of the simulations procedure thanks to \cite{93} for verified simulations data.\\
\paragraph*{Metabolic model.} To calculate the estimated instantaneous metabolic power of subjects, Umberger \cite{105} muscle energetic model which was modified by Uchida et al. \cite{106}, was employed in which average power consumption of a muscle during a gait cycle was calculated using Eq.\eqref{Eqn_avg_muscle_power} \cite{106}.\\
\begin{equation}\label{Eqn_avg_muscle_power}
	P_{avg} = \frac{m}{t_1 - t_0}\int_{t_0}^{t_1} \dot{E(t)} dt
\end{equation}
where $m$ is muscle mass, and $\dot{E(t)}$ is the normalized metabolic power consumed. This model generates metabolic power of all muscles; the whole body metabolic power is then calculated by summing the metabolic power of all muscles\cite{106}. To compute the gross metabolic power consumption of each subject, we integrated the metabolic power over the gait cycle and then normalized it to the mass of each subject.\\
As is mentioned in \cite{93}, due to experimental data insufficiency, the simulations of some subjects and trials were not a complete gait cycle; therefore, the metabolic power was calculated for a half of a gait cycle for these subjects and trials, which is a verified method for computing the energy according to \cite{93}. \\
\paragraph{Joint reaction forces and moments analysis.} Since the equations of motion of the musculoskeletal model were formulated in terms of the generalized coordinates and generalized forces, the internal forces and moments were not solved while performing the computed muscles control or residual reduction algorithm simulations. Consequently, we employed joint reaction analysis provided by OpenSim to compute the resultant forces and moments between two consecutive bodies in the kinematic chain connected via a joint. The contact forces and moments of joints were obtained by formulating them through the Newton-Euler equation of motion and solving recursively from the distal to proximal joints.\\
The free body diagram of $i$th body and joint has been provided in Figure \ref{Fig_JRF_FBD} which has been adopted from the figure represented in the Supplementary Material of \cite{151}. The Newton-Euler formulation for $i$th body can be represented as Eqn. \eqref{Eqn_Body_Reaction_Force} adapted from \cite{151} which has been solved to obtain the contact forces and moments acting on the body.
\begin{equation}\label{Eqn_Body_Reaction_Force}
\left\lbrack \begin{array}{c}
{\mathit{\mathbf{F}}}_{\mathit{\mathbf{o}}} \\
\tau_{\mathit{\mathbf{o}}} 
\end{array}\right\rbrack =M_i \left(q\right){\mathit{\mathbf{a}}}_i +{\mathit{\mathbf{F}}}_{\mathrm{c}\mathrm{o}\mathrm{n}\mathrm{s}\mathrm{t}\mathrm{a}\mathrm{i}\mathrm{n}\mathrm{t}\mathrm{s}} -\left(\sum_{\;}^{\;} {\mathit{\mathbf{F}}}_{\mathrm{m}\mathrm{u}\mathrm{s}\mathrm{c}\mathrm{l}\mathrm{e}} +{\mathit{\mathbf{F}}}_{\mathrm{e}\mathrm{x}\mathrm{t}\mathrm{e}\mathrm{r}\mathrm{n}\mathrm{a}\mathrm{l}} +{\mathit{\mathbf{F}}}_{\mathrm{g}\mathrm{r}\mathrm{a}\mathrm{v}\mathrm{i}\mathrm{t}\mathrm{y}} +{\mathit{\mathbf{R}}}_{i+1} \right)
\end{equation}
\begin{figure*}[!t]
	\centering
	\includegraphics[scale=0.35]{Cartoons/JointReactionForce_FBD.pdf} 
	\caption{\small{\textbf{Free body diagram of a body.} The free body diagram of a body which was used for computing the reaction forces and moments of the of $i$th joint. The $G$, $S_i$ and $J$ frames represent the ground or Newtonian frame, body frame, and joint frame (i.e. offset frame according to the OpenSim terminology). The $\sum\mathbf{F}_{muscles}$ and  $\sum\mathbf{M}^{F_{muscles}/P^*}_{muscles}$ are resultant force and moment of the forces and moments of musculotendon actuators. The points $O$, $S^*_i$, and $J_o$ are the origin of the body, center of mass of body, and center of joint. }}
	\label{Fig_JRF_FBD}
\end{figure*}
where $M_i(q)$ and ${\mathit{\mathbf{a}}}_i$, respectively, represent the mass matrix of the body $i$ and vector of the linear and angular acceleration of body $i$ expressed at ground frame, and $F_{constaint}$ accounts for the forces applied by constraints, if applicable. Through this equation $F_{muscle}$, $F_{external}$, and $F_{gravity}$ represent the force and moment applied by a muscle, forces applied externally (e.g. ground reaction forces and moments), and gravitational forces applied to the body respectively. Lastly, $R_{i+1}$ accounts for the applied reaction forces from the $(i+1)$th to the $i$th joint.\\
Since these reaction forces and moments are expressed at the origin of the body frame to have all terms in a common reference frame, they need to be transformed to the location of the joint frame (i.e. offset frame) where the joint has been defined between two consecutive bodies as represented in Eqn. \eqref{Eqn_JointReactionForce} \cite{151}.
\begin{equation}\label{Eqn_JointReactionForce}
\left\lbrack \begin{array}{c}
{\mathit{\mathbf{F}}}_i \\
\tau_i 
\end{array}\right\rbrack =\left\lbrack \begin{array}{c}
{\mathit{\mathbf{F}}}_{\mathit{\mathbf{o}}} \\
\tau_{\mathit{\mathbf{o}}} 
\end{array}\right\rbrack -\left\lbrack \begin{array}{c}
{\mathit{\mathbf{r}}}^{{\mathrm{OJ}}_o \;} \times {\mathit{\mathbf{F}}}_O \\
\emptyset_{3\times 1} 
\end{array}\right\rbrack
\end{equation}
The vector of $F_i$ and $\tau_i$ represent the joint reaction force applied to the joint of interest expressed at the ground frame.\\
As was mentioned earlier, this analysis was adopted from the supplementary material of the \cite{151} and we reference the readers to this paper for detailed discussion about this analysis.\\
%%%%%%%%%%%%%%%%%%%%%1%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Modeling and simulation of assisted subjects}
The kinematics of the exoskeletons were already discussed; in order to model ideal exoskeletons in OpenSim framework, we used the Torque Actuators provided by OpenSim API\cite{103}. Torque actuators of the biarticular and monoarticular exoskeletons were assigned, as shown in Figure \ref{Fig_Exos_Model_Opensim}.
\begin{figure*}[h!]
	\centering
	\subfloat[\small{biarticular device}]{\includegraphics[width=2in]{Cartoons/Biarticular_Exo_Assignment.pdf}
		\label{Fig_Bi_Exo_Model_Opensim}}
	\hfil
	\subfloat[\small{monoarticular device}]{\includegraphics[width=2in]{Cartoons/Monoarticular_Exo_Assignment.pdf}
		\label{Fig_Mono_Exo_Model_Opensim}}
	\vspace{1mm}
	\caption{\small{\textbf{Assistive devices modeling on OpenSim.} The modeling of the hip and knee assistive devices in OpenSim framework in which TorqueActuators provided by opensim has been utilized to model the exoskeletons. The blue and red torques represent the action and reaction torques of the assistive actuators on the bodies.}}
	\label{Fig_Exos_Model_Opensim}
\end{figure*}
As is represented in Figure \ref{Fig_Exos_Model_Opensim} \subref{Fig_Bi_Exo_Model_Opensim}, both torque actuators of the biarticular exoskeleton were assigned to the torso; the reaction forces of the actuators were then applied to the torso, which matches the kinematics and dynamics model of the biarticular exoskeleton.
\begin{align}\label{Eqn_Biarticular_Torque_Act}
\tau^{hip}_{Biarticular} = \tau^{torso/femur}\\
\tau^{knee}_{Biarticular} = \tau^{torso/tibia}
\end{align}
The onoarticular exoskeleton (Figure \ref{Fig_Exos_Model_Opensim} \subref{Fig_Mono_Exo_Model_Opensim}) was modeled by assigning the hip joint actuator from the torso to the femur body and the knee joint actuator was assigned from the femur to the tibia body at which the reaction torque of the knee torque applied to femur body:
\begin{align}\label{Eqn_Monoarticular_Torque_Act}
\tau^{hip}_{Monoarticular} = \tau^{torso/femur}\\
\tau^{knee}_{Monoarticular} = \tau^{femur/tibia}
\end{align}
\paragraph*{Computed muscle control adjusted objective function.} To investigate the performance of the assistive devices and their effect on the human musculoskeletal system through the OpenSim simulation framework, we used the CMC algorithm. The computed muscle control algorithm objective function depends on the sum of squared muscle activation and reserve actuators, which compensates for modeled passive structures and potential muscle weakness\cite{93}:
\begin{equation}\label{Eqn_CMC_Normal_Obj_Func}
J = \sum_{i\in nMuscles} a_{i}^{2} + \sum_{i \in nReserves} (\frac{\tau_{r,i}}{w_{r,i}})^2
\end{equation}
where $w_i$ determines the weight of reserve actuators, which is generally selected as a small number to highly penalize the use of reserve actuators. By adding assistive device actuators (i.e. Torque Actuators) to the musculoskeletal model of the subject, they are added to the CMC tool objective function. The adjusted objective function includes the assistive actuators as is expressed in Eq. \eqref{Eqn_CMC_Assisted_Obj_Func}, and by selecting proper weights for the assistive actuators, they can be chosen by the optimizer as the actuation of the assigned degree of freedom.
\begin{equation}\label{Eqn_CMC_Assisted_Obj_Func}
	J = \sum_{i\in nMuscles} a_{i}^{2} + \sum_{i \in nExo} \left(\frac{\tau_{exo,i}}{w_{exo,i}}\right)^{2} +  \sum_{i \in nReserves} \left(\frac{\tau_{r,i}}{w_{r,i}}\right)^2
\end{equation}
In the adjusted objective function, $w_{exo,i}$ is torque actuator weights, which is named optimal force in OpenSim \cite{93} penalizing the usage of torque actuators. By selecting a large number, penalization of the actuators is insignificant and they are selected for actuating the joint between two bodies assigned for the torque actuator. If we select a small optimal force, the optimizer will highly penalize the usage of exoskeleton actuators. To study each configuration of the exoskeleton at their maximum performance, the assigned torque actuator's optimal force was selected as 1000 N.m enabling the optimizer to use the assistive actuators as much as possible during a gait cycle simulation.\\
\paragraph*{Power calculation of metabolics and actuators.} Similar to the unassisted procedure, the instantaneous metabolic power of the subjects was computed using the energetic model of Uchida et al. \cite{106}. The metabolic rate of each subject was then derived through integration of the metabolic power over the gait cycle. In order to compute the energy consumption of the assistive actuators, the power profile of the actuators was obtained and their absolute power profiles were integrated over the gait cycle and normalized to the mass of the subject. Similar to the power consumption of the exoskeleton procedure, the negative power or regeneratable power through a gait cycle was calculated by obtaining the negative power profile and integrating it over the gait cycle and normalizing it to the mass of the subject.\\
\paragraph{Joint stiffness analysis.} To analyze the effect of the purposed devices on the assisted joints' stiffness, we characterized the moment-angle relation of the hip and knee joints. We analyzed then their stiffness in the phases that the hip and knee moment-angle curves exhibit nearly linear behavior by linear fitting in which the slope of the line represents the estimated stiffness of the joints. This stiffness is called quasi-stiffness, which is defined as stiffness that best describes the overall stiffness property of a joint during a specific locomotion task \cite{152,153,155,156,157,159,162,163,164,165,166}. It should be noted that the quasi-stiffness is characterizing the linear phases of locomotion, and it needs to be distinguished from the passive and active stiffness of a joint \cite{167,168,169}.
This method has been previously employed to characterize the stiffness of the lower limb joints in  different locomotion tasks and scenarios \cite{152,153,155,156,157,159,162,163,164,165,166} and designing assistive devices \cite{154,158}, and we closely followed the method developed by Shamaei et al. \cite{155,156} for extracting the quasi stiffness of the hip and the knee joints.\\
Analysis of the moment-angle curve of the hip joint during normal walking shows that the moment and angle have nearly linear association during the terminal stance phase \cite{152}. The terminal stance phase of the hip joint is composed of the extension stage, which begins with the onset of this phase and ends by hip reaching its maximum extension, and the flexion stage starting with maximum hip extension and extends into the initial swing phase \cite{156}. Throughout the terminal stance phase, the hip joint experiences high energy storage during the extension and release during the flexion stage in which the mechanical function of the hip joint is significantly prone to distortion by any disturbance or gait abnormality \cite{156}.\\
The knee joint-moment curve shows this linear relationship during the loading response and mid-stance phases, which are called the weight acceptance phase jointly \cite{155}. The importance of this phase is that the knee joint provides a significant amount of moment during the weight acceptance stage, making the joint highly predisposed to disruption by any external disturbances or musculoskeletal abnormalities similar to the hip joint \cite{155,156,160}. The weight acceptance phase is composed of the flexion stage starting by heel contact and extends to maximum flexion of the first knee flexion arc, followed by the extension stage that ends when the knee joint reaches to the maximum extension of its first extension arc\cite{155}.\\
These linear phases of the hip and knee joints were extracted for each subject by customizing the general duration of the phases \cite{161} for each subject in both load conditions (i.e., {\it loaded} and {\it noload} conditions) and assistance conditions ( i.e., unassisted and assisted conditions) and the stiffness of the joints were characterized to investigate the effect of each assistive device on the stiffness of the joints.
\paragraph{Joint reaction forces and moments analysis.} We performed a similar joint reaction force analysis to study the effect of the assistive devices on the reaction forces and moments of assisted and unassisted joints. Nonetheless, appending assistive devices to the musculoskeletal system modifies the Newton-Euler equations of motion of bodies the Torque Actuators were appended ( i.e., Eqn.\eqref{Eqn_Body_Reaction_Force}) as it is expressed in Eqn. \eqref{Eqn_Body_Reaction_Force_Modified}.
\begin{equation}\label{Eqn_Body_Reaction_Force_Modified}
\left\lbrack \begin{array}{c}
{\mathit{\mathbf{F}}}_{\mathit{\mathbf{o}}} \\
\tau_{\mathit{\mathbf{o}}} 
\end{array}\right\rbrack =M_i \left(q\right){\mathit{\mathbf{a}}}_i +{\mathit{\mathbf{F}}}_{\mathrm{c}\mathrm{o}\mathrm{n}\mathrm{s}\mathrm{t}\mathrm{a}\mathrm{i}\mathrm{n}\mathrm{t}\mathrm{s}} -\left(\sum_{\;}^{\;} {\mathit{\mathbf{F}}}_{\mathrm{m}\mathrm{u}\mathrm{s}\mathrm{c}\mathrm{l}\mathrm{e}} +\sum{\mathit{\mathbf{F}}}_{\mathrm{assistive}} +{\mathit{\mathbf{F}}}_{\mathrm{e}\mathrm{x}\mathrm{t}\mathrm{e}\mathrm{r}\mathrm{n}\mathrm{a}\mathrm{l}} +{\mathit{\mathbf{F}}}_{\mathrm{g}\mathrm{r}\mathrm{a}\mathrm{v}\mathrm{i}\mathrm{t}\mathrm{y}} +{\mathit{\mathbf{R}}}_{i+1} \right)
\end{equation}
where $\sum{\mathit{\mathbf{F}}}_{\mathrm{assistive}}$ represents the applied or reaction torques of the assistive actuators.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Simulations of Multi-criteria Optimization}
The optimization stage of the computed muscle control (CMC) algorithm uses the weighted sum of squares to solve muscles and assigned actuators redundancy to select a set of actuations with the most economical cost for tracking the kinematics of the dynamic model of the subject \cite{92}. To investigate the utmost effect of assistive devices on the metabolic power consumption of assisted subjects, regardless of the power expenditure of devices, large weights were assigned to the assistive actuators.\\
However, in real-time applications, the exoskeletons are restricted by the power that can be supplied to their actuation modules and the maximum assistive torque that the actuation module can provide to the joint of interests. To study the performance of the purposed devices under constrained maximum torques that the assistive actuators can provide to the joints and their effect on the musculoskeletal system with lower power demands, we adopted the Pareto methods for multi-criteria concept\cite{113} and implemented it through musculoskeletal simulation framework.\\
The Pareto methods integrate all optimization criteria in its procedure and construct a Pareto front representing non-dominant solutions among the criteria enabling us to have optima curves for each configuration of the devices \cite{107} and conduct a fair comparison between the exoskeletons and the load conditions. In this study, the metabolic cost reduction and assistive actuators power consumption were considered two optimization criteria to study and compare different configurations of the exoskeletons in both load conditions.\\
One of the acceptable Pareto fronts is a discrete set of Pareto-optima points obtained through constructing a single objective function by integrating objectives and optimizing the single cost function throughout the specific range of values of the parameters used to combine the cost functions into a single objective function \cite{108}.\\
The Pareto optimization method has been used by M. L. Handford and M. Srinivasan\cite{111,127} to study robotic lower limb prostheses by simultaneously optimizing the metabolic and prosthesis cost rate. \\

\paragraph*{The workflow of the simulations.} To perform the simulations of the Pareto-optimization in the OpenSim framework, we constrained the peak torque of assistive actuators throughout a specific range of torque they can provide during a gait cycle, which constrains the objective function mentioned in Eq \eqref{Eqn_CMC_Assisted_Obj_Func} and changing the solution of the optimizer for the muscles and actuators redundancy problem. This variation over a discrete range of the maximum torque that assistive actuators can provide results in several solutions on the optimization objectives space. By filtering these Pareto curves and obtaining the non-dominant solutions, we achieved Pareto front for each configuration of the exoskeleton in both load conditions.\\
For both the biarticular and monoarticular exoskeletons, the maximum torque that their actuators could provide to the hip and knee joints was varied between 30 N.m and 70 N.m. The simulations of this phase were performed by fixing the maximum torque hip actuator can provide and varying the constraint of the knee over the specified range. After conducting simulations of exoskeletons with a fixed hip constraint and varying knee constraint, the maximum torque limit of the hip actuator was modified for performing the next iteration of the simulations. The algorithm has been shown the following pseudo-code.\\
\begin{algorithm}\label{Algorithm_Pareto_simulation}
	\caption{Simulations of Multi-criteria Optimization Algorithm}\label{Pareto_Algorithm}
	\begin{algorithmic}[1]
		\For{$i = [70,60,50,40,30]$}
		\For{$j = [70,60,50,40,30]$}
		\State Set $\{-i,i\}$ : hip actuators constraint: $\{Min Control, Max Control\}$
		\State Set $\{-j,j\}$ : knee actuators constraint: $\{Min Control, Max Control\}$
		\State Update exoskeleton model by the new constraints
		\State Perform \textbf{CMC} Simulation
		\EndFor
		\EndFor
	\end{algorithmic}
\end{algorithm}
\paragraph*{Regeneration effect on the efficiency of optimal devices.} 
The regeneratable power of the optimal exoskeletons can be acquired by capturing the negative power profiles of assistive actuators and obtaining the dissipated energy from the negative power profile. This dissipated energy was normalized by the mass and gait duration of each subject and trial. Although the maximum efficiency of harvesting dissipated power is ranged between 30\% to 37\% for the lower limb assistive devices \cite{140}, the MIT cheetah custom design \cite{144,145} and the biomechanical energy harvester developed by Donelan et al. \cite{143} reported and experimentally verified 63\% regeneration efficiency. Hence, we examined the performance of devices in various efficiency factors and selected 65\% as energy harvesting efficiency for the analyzed exoskeletons, which is the maximum efficiency that has been reported for regeneration. The regeneration effect on the simulated configurations of devices and their optimal trade-off has been studied by subtracting the regeneratable power from the total power consumption of devices.\\
\paragraph*{Root mean square error of profile in gait phases.}  To establish quantitative and systematic comparisons between two profiles of selected optimal devices, we obtained the root mean square error (RMSE) between overall and phases of profiles. The phases of a general gait cycle were adopted from \cite{150,161} and customized for each subject and trial according to their toe-off timing, as it is represented in Figure in \nameref{S2_Fig}. The gait cycle of each subject and trial was then partitioned to its phases, and we used the root mean square error (RMSE) method to compute the difference between two profiles in each phase of the gait cycle and reported them by their mean and standard deviation over the subjects.
\subsection*{The Effect of Optimal Devices Inertial Properties on Subjects Energetics}
The mass and inertia of the proposed biarticular and monoarticular exoskeletons affect the waist, thigh, and shank segments. As discussed in the Kinematic Modeling section, the biarticular exoskeleton is designed to deliver the assistance distally to the knee joint. This property of the biarticular exoskeleton enables designers to attach the knee actuation module to the waist instead of the thigh, which is the main difference between the inertial properties of two proposed exoskeletons. Nevertheless, it should be noted that the reflected inertia of the knee actuation module in both exoskeletons will be applied on the shank regardless of its grounded segment.\\
To computationally study the effect of the inertial properties of the exoskeletons on the metabolic rate of assisted subjects, we assigned two identical mass and the center of mass measured from the hip joint for the links attached to the thigh and shank. Moreover, a typical and identical inertia and mass was selected for actuation module of both exoskeletons. Additionally, the maximum achievable torque of the actuator was set to 2 N.m which can be provided by MaxonMotor EC90 Flat 260W, and the required transmission ratio was calculated by diving the peak torque at the joint level to peak torque of the actuator and then reflected inertia was computed using Eqn.\eqref{Eqn_reflected_inertia}.\\
\begin{equation}\label{Eqn_reflected_inertia}
\begin{aligned}
R &= \frac{\tau_{max,jont level}}{\tau_{max,actuator}}\\
I_{reflected} &= I_{actuator}\times R^{2}
\end{aligned}
\end{equation}
The inertia of the moving segments (i.e., thigh and shank segments) was computed by considering the distal mass effect on the inertia, reflected inertia of the actuation module, and the leg inertia provided by \cite{133} which was calculated about the hip joint in the body frame. The Eqn.\eqref{Eqn_segment_inertia} represents the inertia calculation of the moving segment.
\begin{equation}\label{Eqn_segment_inertia}
\begin{aligned}
I_{Exo,segment} &= I_{reflected} + m\times COM^{2}\\
I_{\textit{loaded}\;leg} &= I_{Exo,segment} + I_{\textit{\textit{noload}}\;leg}
\end{aligned}
\end{equation}
The mass, the center of mass, and inertia used for the numerical simulations are represented in Table \ref{Table_Exokeletons_Mass_Inerta}. The mass of each segment is within range of weight of exoskeletons studied by Mooney et al.\cite{41} for calculating the augmentation factor and the center of mass of the segments were mostly chosen based on the mean length of thigh and shank segments\cite{136} under the assumption of unity distribution of links' weight.\\ 
\begin{table}[ht]
	\renewcommand{\arraystretch}{1.2}
	\begin{adjustwidth}{-1in}{0in}
		\caption{\small{\textbf{Mass and inertia properties of two typical exoskeletons.}}}
		\begin{tabular}{c!{\vline width 0.2pt}c!{\vline width 0.2pt}c!{\vline width 0.2pt}c!{\vline width 0.2pt}c!{\vline width 0.2pt}c!{\vline width 0.2pt}c}
			\toprule
			\multirow{2}{*}{\textbf{configuration}} & \textbf{Waist}   & \multicolumn{2}{ c!{\vline width 0.2pt} }{\textbf{thigh}} & \multicolumn{2}{ c!{\vline width 0.2pt} }{\textbf{shank}} & \textbf{actuator} \\  \cmidrule{2-7}
			&  Mass ($kg$)& mass ($kg$) & COM ($m$)& mass ($kg$) & COM ($m$)& inertia ($kg.m^2$) \\ \midrule[0.5pt]
			\textbf{Biarticular} &  4.5 &1& 0.23 &0.9&0.18 + $l_{thigh}$&$5.06\times10^{-4}$\\ \midrule[0.2pt]
			\textbf{Monoarticular} & 3 &2.5& 0.30 &0.9&0.18 + $l_{thigh}$&$5.06\times10^{-4}$\\
			\bottomrule
		\end{tabular}
		\label{Table_Exokeletons_Mass_Inerta}
	\end{adjustwidth}
\end{table}
The metabolic model proposed by Browning et al. \cite{133} calculates the metabolic rate of the subject with loaded segment; however, since we were interested in the effect of inertial properties of the exoskeletons on the change of the metabolic rate, we adopted and modified the model by subtracting the metabolic rate of the unassisted subject subjects from the subjects wearing the devices. The equations of the final model used to analyze the effect of inertial properties of the exoskeletons on the metabolic rate are provided in Eqn.\eqref{Eqn_AddingMass_MetabolicRate} and \eqref{Eqn_AddingInertia_MetabolicRate} respectively.
\begin{equation}\label{Eqn_AddingMass_MetabolicRate}
\begin{aligned}
\Delta MC_{Waist} &= 0.045\times m_{Waist}\\
\Delta MC_{Thigh} &= 0.075\times m_{Thigh}\\
\Delta MC_{Shank} &= 0.076\times m_{Shank}
\end{aligned}
\end{equation}
\begin{equation}\label{Eqn_AddingInertia_MetabolicRate}
\begin{aligned}
I_{ratio} &= \frac{I_{Exo,segment} + I_{un\textit{loaded}\;leg}}{I_{un\textit{loaded}\;leg}}\\
\Delta MC_{Thigh} &= ((-0.74 + (1.81\times I_{Thigh,ratio}))\times MC_{unassisted})-MC_{unassisted}\\
\Delta MC_{Shank} &= ((0.63749 + (0.40916\times I_{Shank,ratio}))\times MC_{unassisted})-MC_{unassisted}
\end{aligned}
\end{equation}
The effect of the mass and inertia of the exoskeletons on the metabolic cost of the subjects was reflected on the Pareto curves and filtered to obtain the Pareto front curves with the effect of the exoskeleton inertial properties on the metabolic expenditure.\\
\paragraph*{Modified Augmentation Factor.} In studying selected cases from the solutions of the Pareto front curves, we need to have a more systematic analysis of the performance of devices under their inertial properties effect that can be employed for both {\it loaded} and {\it noload} conditions. Consequently, we used augmentation factor \cite{41} with some primary modifications.\\
The augmentation factor (AF) was developed by Mooney et al. \cite{41} to address the limitations of the performance index introduced by Sawicki and Ferris \cite{149} to measure the relationship between the device applied positive power and change in metabolic power consumption. The augmentation factor was established to estimate metabolic power change due to carrying the exoskeleton, which balances the mean positive power, resulting in a metabolic improvement and net dissipated power and device weights, causing metabolic detriment.\\
Although the augmentation factor resolved the previous performance metrics difficulties and introduced a general factor for predicting the performance of assistive devices, it did not address the effect of inertia caused by the actuation unit and attached masses in moving segments. The study accomplished by Browning et al. \cite{133} noted the importance of the inertia effect on the metabolic burden of subjects showing the necessity of including this factor for any performance measurement of exoskeletons.\\
The modified augmentation factor (MAF) was introduced to address this central issue on the augmentation factor. In order to include the inertia effect on the augmentation factor, we adopted the model developed by Browning et al. \cite {133} for estimating the metabolic power ratio change due to inertia ratio change of subjects walking while wearing weights on their lower limbs to subject walking without any load. Then, we performed some simple algebraic manipulations to obtain the device location factor ($\gamma_{i}$) for the applied inertia to each segment, as is represented in Eqn.\eqref{Eqn_Inertia_Factor}. It is noteworthy to mention that $\gamma_{i}$ was obtained under the assumption of device inertia addition to the inertia of unloaded leg.
\begin{equation}\label{Eqn_Inertia_Factor}
\gamma_{i} = \frac{A_i\times m_{subjects}\times MC_{unloaded}}{I_{unloaded}} \qquad i \in \{1,2,3\}
\end{equation}
In this inertia position factor represented in Eqn.\eqref{Eqn_Inertia_Factor}, $A_i$ is the multiplier of $I_{ratio}$ in Browning models for foot, thigh and shank segments and $I_{unloaded}$, $m_{subjects}$, and $MC_{unloaded}$ are the inertia of leg without any external load, mean weight of subjects, and metabolic rate of subjects walking without any load on their segments respectively which were obtained from the \cite{133} models and plots. The modified augmentation factor (MAF) was obtained by adding the effect of inertia on the metabolic detriment part of this factor, and it can be expressed as Eqn.\eqref{Eqn_MAF}.
\begin{align}
MAF &= \frac{p^{+}+p^{disp}}{\eta}-\sum_{i=1}^{4}\beta_{i}m_{i}-\sum_{j=1}^{3}\gamma_{j}I_{j}\label{Eqn_MAF}\\
p^{disp} &= \alpha(p^{-}-p^{+}) \qquad \alpha = \left\{\begin{array}{ll}1\quad p^{+}<p^{-}\\0\quad p^{+}\geq p^{-}\end{array}\right.\label{Eqn_disp_power}
\end{align}
Where $p^{+}$, $p^{-}$, and $p^{disp}$ are representing mean positive, negative, and dissipated power calculated through Eqn.\eqref{Eqn_disp_power}. The $\beta_i$ in MAF stands for the location factor of the device mass which is 14.8, 5.6, 5.6, and 3.3 $W/kg$ from the foot to waist respectively \cite{41,133} and $\gamma_j$ is representing the location factor of the device inertia which is 47.22, 27.78, and 125.07 $W/{kg.m^2}$ from the foot to thigh respectively. Consistent with augmentation factor procedure \cite{41}, MAF uses muscle-tendon efficiency,$\eta = 0.41$ to convert the mechanical assistive power to metabolic power determined empirically by Sawicki and Ferris\cite{149} and Malcolm et al.\cite{40}. Finally, we normalized modified augmentation factor by the weight of each subject.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Validation of Simulations}
The comprehensive validation procedure of the OpenSim simulations was published by Hicks et al. \cite{92} in which they explained how to validate modeling and simulation results at each stage. Additionally, Dembia et al. \cite{93} explained simulation verification for their simulations of assistive devices, and  we followed the same procedures explained in \cite{92,93} to validate our results from the simulations.\\
As is already discussed, the adjusted model, adjusted kinematics, and processed ground reaction forces provided by \cite{93} were used for accomplishing this study, which was evaluated and validated by Dembia et al. \cite{93}. The muscular activation resulting from the simulations of unassisted subjects was validated with the experimentally recorded electromyography (EMG) signals \cite{92,93} in which there were some timing and magnitude discrepancy between simulated and experimentally collected activation of some muscles which was due to excessive passive forces in knee and ankle joints.\\
The \textit{loaded} and \textit{\textit{noload}} joint kinematics and kinetics were compared with the results of the studies accomplished by Huang and Kuo \cite{131} and Silder et al.\cite{132} and validated qualitatively. Since our simulations of the unassisted subject for \textit{loaded} and \textit{noload} conditions were the same with Dembia et al. simulations, we reproduced their simulations and compared them with their results to validate our reproduced simulations results. Additionally, since we used the provided RRA results for performing the CMC simulations, the joint moment and joint kinematics represented in this paper were already validated.\\
The other source of error during the simulations is kinematics error, which was analyzed to be in the recommended thresholds by Dembia et al.\cite{93}. Since the inverse kinematics stage of the simulation was not reproduced in this study, the markers error was not examined, and we relied on the previously performed verification on this error source. The analysis of Dembia et al. \cite{93} on residual errors showed that the residual forces lie below the threshold recommended by Hicks et al. \cite{92}; however, the residual moments exceeded from the Hicks et al. thresholds but since the joints moment were matching with \cite{92}, it was claimed that these exceeding residual moments do not affect the interpretations \cite{131,132}.
Another error source in these simulations could be additional moments introduced to compensate any unmodeled passive structures and muscle weakness, which were checked to be in their recommended thresholds to have less than 5\% of net joint moments in peak and RMS \cite{93}.\\
To ensure that our simulations in both ideal and Pareto-optimization phases did not deviate from the defined error source thresholds, we analyzed the kinematics of all simulations and checked their divergence from the adjusted kinematics resulted from the RRA simulations. Additionally, some simulations of the Pareto-optimization part were selected randomly, and their residual and reserve moments and forces were analyzed.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Performance Metrics}
For the purpose of having methodical analysis and comparison between the assistive devices and load conditions, some performance metrics were defined. As discussed earlier, the ultimate goal of each assistive device is reducing energy consumed by the subject for performing a task that was walking with and without load at self-selected speed in this study.
Therefore, we calculated the normalized gross whole-body metabolic rate of the subjects in two different assistive devices and load conditions, and then metabolic cost reduction was computed using the metabolic rate of assisted and unassisted subjects. This procedure of metabolic cost calculation was repeated for all seven subjects in three trials to obtain the total average metabolic energy expenditure and metabolic cost reduction for each assistance scenario and load condition.\\
Another important metric for assessing the performance of an exoskeleton is the power it consumes to assist the subjects. To analyze this metric in the simulated exoskeletons, we computed the absolute power consumed by all actuators, and the reason for considering the absolute value is the absence of the regeneration mechanism as a general case for the exoskeletons. Additionally, to analyze the amount of power available for regeneration, we computed the negative energy of the exoskeletons. The power consumption metric is a crucial part of the exoskeletons analysis to estimate their efficiency and battery life for untethered devices.
At the Pareto optimization part of the study, these two introduced metrics (i.e., metabolic cost reduction and power consumption) were optimized simultaneously, and their set of optimal solutions was represented for each device and load condition. This Pareto front represents the set of different configurations for each exoskeleton in terms of power consumption and the assistance the device can provide. For more detailed analyses, some specific configurations in each exoskeleton and load condition have been selected and studied exhaustively.\\
Additionally, the regeneratable power and inertial properties of the exoskeletons, as two critical metrics for analyzing the performance of the assistive devices, have been studied in simulations of multi-criteria optimization by reflecting their effect on the Pareto-curves and obtaining the Pareto sets under the effect of these two metrics.
Some muscular activations of the lower limb key muscles were extracted and studied to gain insight into how an assistive device can change muscle activities and, consequently, metabolic cost resulting from muscle activities. 
Lastly, the reaction forces and moments of the joints and their stiffness were computed to gain insight into the effect of assistive devices on the reaction forces of the joints. 
\subsection*{Statistical Analysis}
To conduct methodical comparisons among scenarios with the discussed metrics, we employed statistical analyses. Since the simulations were performed on seven subjects with three trials in five different scenarios, repeated measures analysis of variance (ANOVA) and Tukey Post-hoc were applied to test the statistically significant difference between the selected metrics and scenarios.  Additionally, for the Pareto simulations, the statistical analysis has been performed for the specific points selected from the Pareto front for further investigation. Nevertheless, the standard deviation of all points on the Pareto front was explicitly plotted for both criteria. We used a significance level of 0.05 and SPSS \cite{spss} for performing the tests. 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Results and Discussion}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Ideal Exoskeletons Results}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection*{Device Performance}
Both biarticular and monoarticular configurations of the ideal exoskeletons reduced the metabolic energy consumption of subjects walking without and with carrying a heavy load at self-selected speed walking. Biarticular and monoarticular exoskeletons decreased the subjects carrying a heavy load metabolic rate by 20.49$\pm$2.87\% and 20.45$\pm$2.81\%. The monoarticular and biarticular configurations of the exoskeleton were able to reduce the gross whole-body metabolic cost of the subject in the \textit{noload} condition by 22.38$\pm$4.91\% and 22.47$\pm$4.89\%. These exoskeletons were expected to have the same performance on reducing the metabolic energy consumption of the subjects due to their kinematic relation, and the results are representing the expected performance for these two devices.\\
\begin{figure*}[ht]   
	\centering
	\includegraphics[width=\linewidth]{Ideal_Exo_MonovsBi_Figures/Paper_Figure_Energy_BoxPlot.pdf}
	\vspace{1mm}
	\caption{\small{\textbf{Assistive devices and metabolic power.} The power consumptions of assistive devices and their effect on whole-body metabolic rate of the subjects walking with and without carrying a heavy load. Asterisks indicate statistically significant differences (7 subjects, 3 trails, Tukey Post-hoc, $P < 0.05$).}}
	\label{Fig_IdealExo_Energy_BoxPlot}
\end{figure*}
The assistance of both exoskeletons on subjects carrying a heavy load was able to compensate for demanding metabolic energy for carrying the heavy load. As it can be seen in Figure \ref{Fig_IdealExo_Energy_BoxPlot}, the assisted subjects in \textit{loaded} condition have a similar metabolic rate with unassisted subjects do not carry any load meaning that the best both ideal exoskeletons can do is reducing the metabolic energy-demanding of the \textit{loaded} subject to subject without any load.\\
The energy consumption of both exoskeletons has a high within-subject variation on the \textit{loaded} condition comparing to the \textit{noload} condition. While monoarticular exoskeleton had less energy consumption in both knee and hip actuators and both conditions, but these differences are not statistically significant between the two exoskeletons.  Although both exoskeletons have considerably different hip actuator energy consumption between \textit{noload} and \textit{loaded} conditions, the significant difference between the loading conditions of the subjects cannot be observed for energy expenditure of the knee actuator in both configurations.\\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection*{Devices Speed, Torque and Power}
One of the main objectives of this section is to validate the kinematic modeling of the exoskeleton on OpenSim. As it is already discussed, there is a mapping between monoarticular and biarticular exoskeletons, and if the modeling of the devices were correct in the musculoskeletal simulator, this kinematics relation requires to be held.\\
The Figure \ref{Fig_IdealExo_Speed} represents the velocity profiles of the biarticular and monoarticular exoskeletons in both load conditions. From the Eqn. \eqref{Eqn_Mono_Bi_Jacobian} we were expecting to have the same angular velocity profiles hip actuator, and since hip actuator in both exoskeletons were supposed to be attached directly to the hip joint, the velocity of the joint and actuators in both devices have practically the same profiles as it is shown in Figure \ref{Fig_IdealExo_Speed}  for hip joints in both load conditions.\\
\begin{figure*}[ht]   
	\centering
	\includegraphics[width=\linewidth]{Ideal_Exo_MonovsBi_Figures/PaperFigure_Exoskeletons_Speed.pdf}
	\vspace{1mm}
	\caption{{\small\textbf{Assistive devices velocity profiles compared to joint required velocities.} The device actuator velocity for subjects carrying heavy load (dark blue) and without any load (blue), and net joint velocity profile for \textit{loaded} (black) and \textit{noload} (green) conditions are shown for each actuator of the devices. The curves are averaged over 7 subjects with 3 trials; shaded regions around the mean profile indicate standard deviation of the profile.}}
	\label{Fig_IdealExo_Speed}
\end{figure*}
The main difference between the two configurations of the exoskeleton is on the knee joint, where the biarticular device assists the joint through a parallelogram mechanism, and the velocity profiles of the knee actuator were supposed to be different according to their jacobian. This difference can be seen in the Figure \ref{Fig_IdealExo_Speed} where monoarticular knee actuator follows the knee joint velocity profile, but the biarticular actuator is showing different profile than the knee joint profile due to Eqn. \eqref{Eqn_Mono_Bi_Jacobian}. Analyzing velocity profiles of the devices validating the mapping between two exoskeletons and modeling of them through OpenSim.\\
According to the jacobian between these two devices expressed in Eqn. \ref{Mono_Bi_Torque_Mapping}, the knee and hip actuators were expected to have the same and different torque profiles respectively, which is evident in Figure \ref{Fig_IdealExo_Torque} for both \textit{loaded} and \textit{noload} conditions. The generated optimal torque profiles of the ideal exoskeletons did not resemble the net moment of the assisted joint, which was also observed by \cite{93,2} for the simulation-based study of the walking with heavy load and running respectively. The torque of assistive actuators in both hip and knee joints exceeded the corresponding net joint moment and resulted in opposing muscles generated moment and device torque in the joint.\\
\begin{figure*}[ht]   
	\centering
	\includegraphics[width=\linewidth]{Ideal_Exo_MonovsBi_Figures/PaperFigure_Exoskeletons_Torque.pdf}
	\vspace{1mm}
	\caption{{\small\textbf{Assistive devices torque profiles compared to joint and muscles generated moment.} The device actuator torque for subjects carrying heavy load (dark blue) and without any load (blue), net joint moment profile generated by unassisted muscles for \textit{loaded} (black) and \textit{noload} (green) conditions, and the generated moment by assisted muscles for \textit{loaded} (dark rose red) and \textit{noload} (rose red) conditions are shown for each actuator of the devices. The curves are averaged over 7 subjects with 3 trials and normalized by subject mass; shaded regions around the mean profile indicate standard deviation of the profile.}}
	\label{Fig_IdealExo_Torque}
\end{figure*}

This antagonism is more significant on the knee joint than hip during the mid-stance phase to the mid-swing phase, with the highest opposition on the start of the pre-swing phase. The hip joint has significant actuator and muscle torque opposition during the pre-swing to terminal swing phases meaning unlike the knee joint in which major portion of antagonism happens during the stance phase; the hip is getting into muscle and actuator torque contraction during swing phase. \\
The torque profiles represented in Figure \ref{Fig_IdealExo_Torque} indicate that the loading subject with a heavy load does not result in substantial changes in the torque profiles of the assistive devices. The main changes between \textit{loaded} and \textit{noload} conditions are the timing and magnitude of the profiles, which is due to the change of the joints kinematics and kinetics.
Nevertheless, the standard deviation of assistive devices and assisted muscles generated torques are considerably greater in the \textit{loaded} condition, and it is more evident in the knee joint where the net joint moment has a remarkable deviation during the stance phase. This high within-subject deviation of torque profiles indicates that the assistance of subjects carrying heavy load requires the subject-specific design of the exoskeletons \cite{2}.\\
\begin{figure*}[ht]   
	\centering
	\includegraphics[width=\linewidth]{Ideal_Exo_MonovsBi_Figures/PaperFigure_Exoskeletons_Power.pdf}
	\vspace{1mm}
	\caption{{\small\textbf{Assistive devices power profiles compared to joint powers.} The device actuator power for subjects carrying heavy load (dark blue) and without any load (blue), and net joint power profile for \textit{loaded} (black) and \textit{noload} (green) conditions are shown for each actuator of the devices. The curves are averaged over 7 subjects with 3 trials and normalized by subject mass; shaded regions around the mean profile indicate standard deviation of the profile.}}
	\label{Fig_IdealExo_Power}
\end{figure*}
Due to the discussed kinematic differences between two configurations, the power profile of the exoskeletons were different in both actuators as it is represented in Figure \ref{Fig_IdealExo_Power}. The magnitude of mechanical work performed by the biarticular actuators are higher than monoarticular mechanical work, and their profiles are different during the gait cycle except in the loading response and partially in mid-stance phases. The load carried by subjects causing different timing and magnitude than subjects walking with no load and the deviation of the profiles are higher for the \textit{loaded} subject, which both are observed in torque profiles as well.\\
Although the power profiles of hip actuators were roughly following the net joint power profile, the knee actuator profiles not resembled the knee joint power. The mechanical work performed by the assistive devices were mostly positive work for both knee and hip actuators. The negative mechanical work in the biarticular exoskeleton can be harvested mostly during the initial-swing and mid-swing phases for the knee actuator and terminal phase for the hip actuator. Unlike the biarticular device, the monoarticular hip actuator performed practically no negative mechanical work, and the regeneratable work of the knee actuator is within both mid-stance and late-swing phases.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection*{Effect of Device on Subjects Muscles}
\begin{figure*}[ht!]
	\centering
	\subfloat[\small{biarticular muscles}]{\includegraphics[width=2in]{Cartoons/Saggital_Leg_Biarticular_Muscles.pdf}
		\label{Fig_Bi_Muscles}}
	\hfil
	\subfloat[\small{monoarticular muscles}]{\includegraphics[width=2in]{Cartoons/Saggital_Leg_Monoarticular_Muscles.pdf}
		\label{Fig_Mono_Muscles}}
	\vspace{1mm}
	\caption{\small{\textbf{Biarticular and monoarticular representative lower extremity muscles}}}
	\label{Fig_Muscles}
\end{figure*}
\begin{figure*}[ht]   
	\centering
	\includegraphics[width=\linewidth]{Ideal_Exo_MonovsBi_Figures/PaperFigure_Biarticular_MuscleActivation.pdf}
	\vspace{1mm}
	\caption{{\small\textbf{Activation of representative lower limb muscles of assisted and unassisted subjects.} The activation of unassisted subjects carrying heavy load (black) and without any load (green), and assisted subjects in \textit{loaded} (dark violet) and \textit{noload} (pink) conditions are shown for nine important muscles. The curves are averaged over 7 subjects with 3 trials.}}
	\label{Fig_IdealExo_MusclesActivation}
\end{figure*}
The muscular activation of the subjects assisted by ideal assistive devices has been considerably altered. Appending a set of ideal actuators with high optimal force (i.e., low penalization) to the musculoskeletal model changes the solution of the optimizer for finding a set of actuators to track the kinetics and kinematics of the joints.\\
The effect of appending ideal actuators not necessarily decreases the activity of all muscles, and it can be more economical for the complete set of actuators to increase the activity of specific muscles during some phases of gait to decrease the activity of less cost-effective muscles. Since metabolic power of muscles is a function of their activity, and their fiber properties \cite{106}, the reduction in the activity of the entire set of muscles is resulting in gross whole-body metabolic cost reduction.\\
Despite the kinematic difference between the two configurations of the assistive device, the applied torques to the joints are practically identical, and it resulted in an identical effect on the muscular activation of the subjects.\\
The reason for this issue rooted in the ideal nature of the actuators and devices, meaning that there are no constraints on the torque actuators can provide, the devices are assumed to be massless, and actuators do not have any reflected inertia effect. The muscle activation in Figure \ref{Fig_IdealExo_MusclesActivation}, which is showing the effect of the biarticular device on the activation of representative muscles, is sufficient and can be generalized for both configurations of the assistive device. \\
The devices affected the activity of muscles throughout the lower extremity. This effect was significant on the Bicep femoris short head, Semimembranosus, and vasti muscles, where their activation has been replaced by another set of actuators, including muscles and ideal actuators.  The rectus femoris, which is a large knee extensor and hip flexor biarticular muscle,  activity has been considerably increased during the stance phase. This occurred so that the optimizer could take advantage of the rectus femoris high force-generating capacity to exert hip flexion and knee extension moments more economically. In the meanwhile, this high muscular activity of the rectus femoris resulted in high knee extension and hip flexion moments exceeding net joint moment of the joints that have been neutralized by ideal actuators, which are extremely economical for applying high torques due to its high optimal force assignments.\\
This set of activation in which hip flexion and knee extension required moment could be applied by more cost-effective muscles and actuators resulted in a substantial reduction in the activity of psoas and iliacus muscles as two major hip flexor muscles and the vasti muscles (vastus lateralis, vastus intermedius, and vastus medialis) as knee extensor set of muscles. The semimembranous muscle is another biarticular muscle contributing to hip extension and knee flexion moments, which has been affected by the assistive devices, and the new set of actuation has practically replaced its activity. The medial gastrocnemius as a critical knee flexor and ankle plantar flexor muscle has been affected by the assistive devices in which its activity has been substantially reduced, yet the muscle remained partially active to supply an ankle plantarflexion moment. The reduction of ankle plantarflexion moment has been compensated by increasing the activity of soleus as another primary ankle plantarflexor muscle. The assistive devices affected the activity of the gluteus medius muscles as well, which are not only responsible for a large fraction of hip abduction moment, but also they contribute to hip motion in the sagittal plane as well and hip rotation.\\
The anterior and posterior portions of the gluteus medius muscle, besides their primary contribution to hip abduction, were supporting the hip extension and flexion and its lateral and medial rotations. However, the contribution of thiese muscles to the hip sagittal moment replaced by assistive devices and a modified set of activations in assisted subjects, and it resulted in their muscular activity reduction.\\
The main differences between the muscular activity of the subjects walking normally and subjects walking while carrying a heavy load on torso are the magnitude and timing of the muscular activations which were observed already in other profiles as well. This load condition affected partially some muscles like Semimembranosus in which the device did not completely replaced by the ideal devices.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Pareto Simulation Results}
\subsubsection*{Optimal devices performance}
The assistive devices analyzed in the previous section, and their effect on metabolic cost and muscular activation of the subjects in two different load conditions have been studied. The simulations of the previous section were performed under the assumption that the assistive actuators have no bounds on the amount of the moment they can supply to the musculoskeletal model. However, this assumption is not a descriptive assumption for the real-time designing and controlling assistive device because the devices and especially untethered exoskeletons have some constraints on the amount of moment that their actuation unit can provide to assist the joint of interest and the suppliable energy from the battery for untethered exoskeletons is limited by the battery life. \\
One of the main aims of Pareto simulations was addressing this limitation through a simulation-based study in which we can analyze the performance of assistive devices under the limitation of their actuators on providing torque to the joints. 
The study has been accomplished by constraining the peak torque the assistive actuators can provide, and the optimal trade-off between the metabolic cost reduction and energy consumption of the devices has been obtained. The average Pareto front for the biarticular and monoarticular exoskeletons for both loading conditions of the subjects are represented in Figure \ref{Fig_Main_Paretofronts}.\\
\begin{figure*}[ht]   
	\centering
	\includegraphics[width=\linewidth]{Pareto_Simulations_Figures/PaperFigure_Main_Pareto.pdf}
	\vspace{1mm}
	\caption{{\small\textbf{Optimal trade-offs between metabolic cost reduction and device energy consumption.} The label on each marker is denoted to results from different peak torque constraints. The hip and knee constraints are labeled from {\it A} to {\it E} and {\it a} to {\it e} respectively. The {\it A, a} to {\it E, e} labels represent for 70 N.m to 30 N.m constraints respectively, and each marker, which stands for a specific configuration of a device, is labeled by the hip and knee constraints labels. The optima points on Paretofronts are resulted from averaging over 7 subjects.}}
	\label{Fig_Main_Paretofronts}
\end{figure*}
\begin{figure*}[ht]   
	\centering
	\includegraphics[width=\linewidth]{Pareto_Simulations_Figures/PaperFigure_Paretofront_EnergyBarPlot.pdf}
	\vspace{1mm}
	\caption{{\small\textbf{Energy consumption of optimal assistive actuators}. The horizontal axis shows the device number on the optimal pareto-front. The vertical lines represent the standard deviation of devices in 7 subjects.}}
	\label{Fig_Paretofronts_Actuators_EnergyBarPlot}
\end{figure*}
One of the immediate implications these Pareto fronts are providing is that the constrained devices in their maximum torque bounds where hip and knee restricted to 70 N.m peak torque, can mostly provide assistance that has been provided by the ideal exoskeletons with lower energy consumption in both load conditions (Table \ref{Table_Device_Performance_Comparison}).  Both constrained devices were able to assist the \textit{noload} subjects as much as the ideal exoskeletons were assisting, whereas the energy consumption in the biarticular exoskeleton was reduced considerably reduced compared to its ideal actuation, but the monoarticular energy consumption was practically the same with its ideal configuration.\\
Similar to the \textit{noload} condition, the constrained devices had a high metabolic reduction in the \textit{loaded} subjects; even though it was not the same with the ideal configuration of the devices, the energy consumption had a considerable reduction, especially in the biarticular configuration which is the same as the \textit{noload} condition.
The performance of devices under peak torque limitation and its comparison with the ideal devices implies that the comparison of assistive devices with unlimited actuation units is not a legitimate comparison suggesting that the comparison between assistive devices should be conducted using optimal trade-off points of devices in which a device has its optimal performance in both energy consumption and metabolic cost reduction criteria.\\
\begin{table}[ht]
	\centering
	\renewcommand{\arraystretch}{1.2}
	\begin{adjustwidth}{-2.2in}{0in}
	\caption{\small{\textbf{Device performance in with ideal and constrained actuators.}}}
	\begin{tabular}{c!{\vline width 0.2pt}c!{\vline width 0.2pt}c!{\vline width 0.2pt}c!{\vline width 0.2pt}c!{\vline width 0.2pt}c}
		\toprule
		\multirow{2}{*}{\textbf{configuration}} & \multirow{2}{*}{\textbf{device type}} & \multirow{2}{*}{\textbf{condition}} & \textbf{hip energy}& \textbf{knee energy} & \textbf{metabolic cost}\\
		&  &  &\textbf{consumption (W/kg)} & \textbf{consumption (W/kg)} & \textbf{reduction (\%)} \\
		\midrule[0.75pt]
		\multirow{4}{*}{\textbf{biarticular}} & ideal & \textit{noload} & 1.42 $\pm$ 0.32 & 1.58 $\pm$ 0.30 & 22.38 $\pm$ 4.91 \\
		\cmidrule[0.2pt]{2-6}
		& ideal & \textit{loaded} & 1.58 $\pm$ 0.29 & 1.52 $\pm$ 0.29 & 20.49 $\pm$ 2.87 \\
		\cmidrule[0.2pt]{2-6}
		& constrained  & \textit{noload} & 1.30 $\pm$ 0.36 & 1.28 $\pm$ 0.29 & 22.57 $\pm$ 4.92 \\
		\cmidrule[0.2pt]{2-6}
		& constrained  & \textit{loaded} & 1.38 $\pm$ 0.36 & 1.27 $\pm$ 0.29 & 19.54 $\pm$ 2.79 \\
		\midrule[0.75pt]
		\multirow{4}{*}{\textbf{Monoarticular}} & ideal & \textit{noload} & 1.09 $\pm$ 0.24 & 1.24 $\pm$ 0.13 & 22.47 $\pm$ 4.89 \\
		\cmidrule[0.2pt]{2-6}
		& ideal & \textit{loaded} & 1.52 $\pm$ 0.28 & 1.24 $\pm$ 0.27 & 20.45 $\pm$ 2.81 \\
		\cmidrule[0.2pt]{2-6}
		& constrained  & \textit{noload} & 1.06 $\pm$ 0.22 & 1.16 $\pm$ 0.12 & 22.05 $\pm$ 5.18 \\
		\cmidrule[0.2pt]{2-6}
		& constrained  & \textit{loaded} & 1.27 $\pm$ 0.19 & 1.10 $\pm$ 0.26 & 18.68 $\pm$ 2.36 \\
		\bottomrule
	\end{tabular}%
	\label{Table_Device_Performance_Comparison}
	\end{adjustwidth}
\end{table}
The biarticular and monoarticular exoskeletons are showing practically similar performance in assisting subjects with and without load. Nevertheless, analyzing the energy consumption of the devices on the Pareto front reveal that the monoarticular device considerably affected by the load condition of subjects in which the performance of monoarticular exoskeleton became practically identical with the biarticular device when subjects were \textit{loaded} whereas the monoarticular device had superior performance in \textit{noload} condition.\\
The detailed analysis of the monoarticular device show that both actuators of this device were affected by loading subjects with a heavy load (Figure \ref{Fig_Main_Paretofronts} and \ref{Fig_Paretofronts_Actuators_EnergyBarPlot}), and unlike the \textit{noload} condition where knee actuator energy consumption was dominant to the hip in all optimal devices, loading subjects increased the amount of mechanical work of performed by the hip. In contrast, the energy consumption of the biarticular knee and hip actuators was not affected noticeably by loading subjects as Figure \ref{Fig_Paretofronts_Actuators_EnergyBarPlot} representing the energy consumption of optimal devices.Additionally, the optimal configurations of the biarticular exoskeleton are mostly similar in the subjects walking while carrying a heavy load and walking normally, whereas monoarticular exoskeleton has different configurations in both load conditions. The practically similar configurations and the performance of the biarticular exoskeleton in both load conditions can facilitate designing a biarticular device and and developing a generic controller to assist the subjects in different  load conditions.\\
\subsubsection*{Optimal device torque and power profiles }
\begin{figure*}[ht]   
	\centering
	\includegraphics[width=\linewidth]{Pareto_Simulations_Figures/PaperFigure_Paretofront_TorqueProfiles.pdf}
	\vspace{1mm}
	\caption{{\small\textbf{Optimal assistive devices torque profiles compared to joint moments.}Each line represents the torque profile of a different optimal device defined in the color bar. The label on each marker is denoted to results from different peak torque constraints. The hip and knee constraints are labeled from {\it A} to {\it E} and {\it a} to {\it e} respectively. The {\it A, a} to {\it E, e} labels represent for 70 N.m to 30 N.m constraints respectively, and each marker, which stands for a specific configuration of a device, is labeled by the hip and knee constraints labels. The profiles are averaged over 7 subjects with 3 trials normalized by subject mass.}}
	\label{Fig_Paretofronts_Torque_Profiles}
\end{figure*}
The torque profiles of constrained optimal devices slightly differed from the net joint moment of the hip, and the knee joints and the general torque trajectories of these actuators were mostly similar to the torque profiles of the devices with ideal actuators. The ideal and constrained torque profiles of biarticular hip actuators had mostly magnitude differences during mid-stance and terminal-stance to terminal-swing phases. In contrast to the hip actuator, the knee actuator has practically the same profile with the ideal knee actuator during the swing phase, but the path and magnitude of the knee actuator were mostly different from the ideal device. This comparison between the ideal and constrained devices is mostly valid when subjects were walking without carrying any load, and the only difference was the magnitude of the constrained profiles.\\
Both actuators of the constrained monoarticular device have different profiles with the ideal device. The hip actuators had a significant magnitude difference during the load response phase, and most of the optimal constrained hip actuators were saturated during mid-stance and terminal stance phases, which was affecting the trajectory as well. The difference between hip actuators became highly significant during pre-swing to mid-swing phases, where the torque trajectories of the constrained hip actuator were not only different from the ideal actuator but also there was high variation among optimal constrained actuators. The monoarticular knee had more resemblance to the ideal knee actuator torque profile where they had practically identical profiles during the swing phase, and the difference between them was the higher torque magnitude during the mid-stance and lower magnitude during the pre-swing phases.\\
Unlike the biarticular exoskeleton, where the load condition had only effect on the magnitude of the profiles, and there was a close similarity between the torque trajectories in \textit{loaded} and \textit{noload} conditions, the hip actuator torque of the monoarticular device assisting the subjects walking without carrying any load had considerable differences with the \textit{loaded} condition device. These two profiles had two mostly different trajectories and magnitudes during all phases of a gait cycle, and their differences are more unambiguous during load response to mid-swing phases.\\
\begin{figure*}[ht]   
	\centering
	\includegraphics[width=\linewidth]{Pareto_Simulations_Figures/PaperFigure_Paretofront_PowerProfiles.pdf}
	\vspace{1mm}
		\caption{{\small\textbf{Optimal assistive devices power profiles compared to joint power.} Each line represents the power profile of a different optimal device defined in the color bar. The label on each marker is denoted to results from different peak torque constraints. The hip and knee constraints are labeled from {\it A} to {\it E} and {\it a} to {\it e} respectively. The {\it A, a} to {\it E, e} labels represent for 70 N.m to 30 N.m constraints respectively, and each marker, which stands for a specific configuration of a device, is labeled by the hip and knee constraints labels. The profiles are averaged over 7 subjects with 3 trials normalized by subject mass.}}
	\label{Fig_Paretofronts_Power_Profiles}
\end{figure*}
\vspace{2mm}
The restrained biarticular and monoarticular devices had a resemblance to the ideal devices similar to the torque profiles similarity to ideal profiles. The biarticular hip actuator has mostly a similar power trajectory for the hip in both load conditions with considerably lower magnitude for all optimal devices where this magnitude difference is more substantial during mid-stance and initial swing to mid-swing phases; while the knee actuator has a high correlation with the ideal actuator, the loading response and mid-stance phases of the constrained knee actuator is different with the ideal actuator like the torque profile. The constrained monoarticular hip actuator has a high variation within optimal devices, and most of the optimal configurations have their unique power profile; nevertheless, the optimal devices with the highest peak torque limitations have a close resemblance to the ideal device. In contrast to the hip actuators, the power trajectories of the knee actuator in both load conditions were similar to the ideal device with a difference during pre-swing to mid-swing phases where the peak power consumption occurs about the toe-off in the constrained knee actuators.\\
The power and torque profiles of optimal biarticular and monoarticular devices revealing that although the optimal monoarticular exoskeletons have a lower energy consumption comparing to the optimal biarticular devices, the variation of the torque and power profiles within optimal configurations of the monoarticular device is higher than biarticular devices and load condition of the subjects can considerably affect the profiles of assistive actuators. These variations within optimal monoarticular devices indicate that achieving a generalized design and control policies for assisting subjects in different load conditions and different actuation and battery life limitations would be genuinely challenging with monoarticular exoskeletons.\\
\subsubsection*{Regeneration Effect}
The significant energy requirement of the untethered exoskeletons and the finite energy density of the power source of these devices constrain their assisting duration and make them remarkably dependent on their battery life \cite{140}. The review published by Young and Ferris \cite {36} reported that the maximum functioning duration of portable exoskeletons is 5 hours indicating several recharging requirements in a day. Harvesting the dissipated energy of assistive devices can address this issue on the mobile exoskeletons and help users to be more independent by prolonging the device battery life \cite{140,141,142}. The regenerating and harvesting energy has been utilized in different assistive devices to improve the efficiency of the device that has been excellently reviewed in several review papers \cite{140,141,142}.\\
\subsection*{Optimal Devices Inertial Properties Effect}
% TODO: Discuss about 1) The effect of mass and inertia on the kinematic of subjects 2) Assist as needed and zero torque rendering 3) gravity componsation and its effect 3) the inertia compensation methods and its fundumental limitations 4) system level optimization
One of the main challenges with designing the mobile exoskeletons is the effect of the mass and inertia, grounded on the extremities of the subjects, on the metabolic rate of the subjects. The effect of mass and inertia on the metabolic cost has been studied through several literatures \cite{133,134} and it is shown that the metabolic rate of the subject would change considerably by adding mass and inertia \cite{133,134,135}.\\
The proposed exoskeletons in this study have a remarkably different inertial properties due to their kinematic design that will result in different effect on the metabolic energy consumption of the subjects. Since the current neural control algorithm of the OpenSim is not able to simulate any variations in the musculoskeletal model\cite{92}, which has not been captured by experimental data, we simulated the effect of the mass and inertia offline using the model proposed by Browning et al.\cite{133} for the effect of the mass and inertia on the metabolic cost of subjects.\\
The study, accomplished by Browning et al.\cite{133}, proposed a linear model for the effect of adding mass and inertia on each segment of lower limbs by capturing and analyzing the effect of adding mass to different segments of lower extremity and their inertia on the metabolic energy expenditure of the subjects experimentally. In this study, subjects were walking at 1.25 m/s without carrying any heavy load on their torso which is similar to the data captured from the subjects in the walking with \textit{\textit{noload}} at their self-selected speed\cite{93}. This qualitative match between the data and experimental protocols of Browning et al. and Dembia et al enabling us to use the developed model of \cite{133}  to study the effect of mass and inertia added by assistive devices through offline simulations for the subjects walking at free speed without carrying any external load (i.e.{\it noload} condition).\\
\begin{figure*}[ht]   
	\centering
	\includegraphics[width=\linewidth]{Pareto_Mass_Regenration_Figures/PaperFigure_Pareto_Comparison.pdf}
	\vspace{1mm}
	\caption{{\small\textbf{Pareto front of devices in ideal condition and under regeneration and device mass and inertia effects.} The label on each marker is denoted to results from different peak torque constraints. The hip and knee constraints are labeled from {\it A} to {\it E} and {\it a} to {\it e} respectively. The {\it A, a} to {\it E, e} labels represent for 70 N.m to 30 N.m constraints respectively, and each marker, which stands for a specific configuration of a device, is labeled by the hip and knee constraints labels. The optima points on Paretofronts are resulted from averaging over 7 subjects walking in {\it noload} condition.}}
	\label{Fig_Paretofronts_Mass_Regeneration_Effect_Comparison}
\end{figure*}
\vspace{2mm}
The effect of devices inertial properties on the simulated devices are remarkable, and this effect changes most of the devices on the optimal trade-off curve, as represented in Figure \ref{Fig_Paretofronts_Mass_Regeneration_Effect_Comparison}.  The highest peak torque in both monoarticular and biarticular exoskeletons are 60 N.m for the knee and 50 N.m for the hip joint. Since the inertia of devices was getting affected by altering the peak torque, results indicating that the reflected inertia have a considerable effect on the optimality of the devices and power consumption of exoskeletons with high peak torque is not efficient in comparison to the amount of metabolic cost reduction they provide.\\ 
\begin{figure*}[ht]   
	\centering
	\includegraphics[width=\linewidth]{Pareto_Mass_Regenration_Figures/PaperFigure_AddingMass_Pareto.pdf}
	\vspace{1mm}
	\caption{{\small\textbf{The comparison of the pareto fronts of devices in different metabolic and device power expenditure conditions.} The biarticular and monoarticular exoskeletons have been compared in (a)ideal condition, (b)under devices mass/inertia effect on metabolic energy consumption, (c)under dissipated energy regeneration effect on power consumption of devices, and (d)under the effect of (b) and (c). The optima points on Paretofronts are resulted from averaging over 7 subjects walking in {\it noload} condition.}}
	\label{Fig_Paretofronts_Mass_Regeneration_Effect}
\end{figure*}
While the biarticular exoskeleton showed better performance than monoarticular when the exoskeletons inertial properties were considered ( Fig. \ref{Fig_Paretofronts_Mass_Regeneration_Effect}), the slope of Pareto front for both exoskeletons indicates that devices with higher torque capacity will not make a considerable change on the amount of assist that device can provide to the subjects due to the inertia and this effect can be seen more obviously for the monoarticular device.\\
The energy harvesting had a remarkably positive effect on the devices, and it enabled some new configurations in both devices to become optimal in the amount of power consumption for delivered assistance, as shown in Figure \ref{Fig_Paretofronts_Mass_Regeneration_Effect_Comparison}and \ref{Fig_Paretofronts_Mass_Regeneration_Effect}. The changes in Pareto front of biarticular and monoarticular exoskeletons show that regenerating the dissipated power of devices can profoundly reduce the required power for actuating the exoskeleton. This energy requirement reduction enables the battery and mechanical designers to reduce the load on the musculoskeletal system of subjects, which causes metabolic energy consumption increase in the individual being assisted and requires the device to compensate for this increase ahead of providing assistance to the subject. Finally, analyzing both exoskeletons with inertia and mass and regeneration effect reveals that the exoskeletons have dramatically different performance than the ideal devices, as shown in Figure \ref{Fig_Paretofronts_Mass_Regeneration_Effect_Comparison}  for subjects in {\it noload} condition. Unlike the ideal optimal trade-off, the biarticular device shows superior performance than the monoarticular exoskeleton (Fig. \ref{Fig_Paretofronts_Mass_Regeneration_Effect}), and the exoskeletons under regeneration and mass and inertia effect have different optimal configurations than ideal condition.\\
The analyses accomplished for the effect of regeneration and devices inertial characteristics on the performance of assistive devices can provide a qualitative perspective for the mechatronic systems designers on designing assistive devices. The general outcome of these analyses shows that selecting an actuator with high torque density is essential to reduce the reflected inertia effect of gear train on the energy expenditure of subjects. The active inertia compensation methods by designing a controller also can be helpful in reducing the impact of inertia on the metabolic expenditure increase of subjects, which has been used by \cite{148} for controlling one degree of freedom knee exoskeleton to compensate its inertia; however, this method comes with some coupled stability issues \cite{146,147,148} that need to be addressed while designing the controller.\\
The results  also showed that keeping the actuator mass near to proximal joints and assisting the joint of interest distally has a considerable impact on the metabolic power consumption of subjects. As we discussed previously, this mechanical design conclusion has already been studied on the human musculoskeletal system, and it is shown the biarticular muscles enable human musculoskeletal structure to keep muscle volume near to trunk and transfer energy to the distal joints to reduce the inertia and mass of the leg. Consequently, the bio-inspired biarticular and multiarticular configurations of the assistive devices can provide a promising improvement in their performance.\\
Although assistive design with highly effective regeneration requires system-level optimization and complicating the design of assistive devices \cite{140}, even a qualitative comparison between devices with and without regeneration shows a remarkable difference in energy consumption. This implies the necessity of regeneration, especially for untethered devices, to improve their independence and their operation duration.\\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Study Limitations*}
This simulation-based studying assistive device has some limitations that need to be considered for any interpretation of the results. One of the main limitations is kinematics and ground reaction forces for the assisted subjects; Although experimental studies reported that exoskeleton could make a minor \cite{42,79,91,114,115,116} and significant \cite{80,117,118,119} changes on assisted subjects kinematics and joint moment, our simulator's algorithm (CMC) is not capturing these changes and it is assumed that unassisted and assisted subjects have the same kinematics, ground reaction force, and joint moment, nonetheless, it is reported that metabolic cost may not substantially be affected by kinematics changes\cite{120}. This limitation recently has been addressed by employing predictive simulations which can capture the changes in the kinematics and dynamics of the assisted subjects.\\  
Secondly, as it is earlier stated, assistive devices that we modeled was assumed massless without any actuator and link mass and inertia; yet, in practice, exoskeleton actuation modules mass and their reflected inertia on the links are large and one of the main challenges on mechanical design of the exoskeletons and also it is proven that adding mass the lower limbs can considerably change metabolic cost of the subjects. The exoskeletons attachment on the body is also one of the central performance limiting factors of the assistive devices \cite{121} which is not modeled in ideal exoskeletons.\\
Another significant limitation of this study is limitations on musculoskeletal modeling. There are some influential restrictions on muscles modeling that affect the assistive devices simulations results. One of these restraints is extortionate passive force generated by the muscles \cite{92}, that can result in extortionate muscular activities which observed by similar work \cite{93} when they were comparing simulation and experimental muscular activities. Another critical issue in Hill-type muscles modeling is that it does not take into account the muscle fatigue, which is an effective factor in muscle recruitment strategies \cite{92}. Rectus femoris, which is more vulnerable to fatigue due to its fibers properties \cite{123} was experiencing extreme activations in all of the assistance scenarios, which in practice may cause subjects muscles fatigue\cite{122}. Tendon modeling, constant force enhancement, short-range muscle stiffness and some other factors \cite{92} are limiting aspects of the muscles that affect the musculoskeletal models and the simulations results which need to be considered for any interpretation of this study's results.\\
We also would refer the readers to similar papers \cite{2,93}, where they also discussed their studies limitation, which is similar in most of the aspects. Moreover,\cite{92} provides comprehensive information about all aspects of the OpenSim simulations and propose some recommendation for any interpretation and validation of the simulations that can be beneficial to have an accurate interpretation of our results.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Conclusions and Future Work*}
In this study, we investigate how introducing biarticular configuration on assistive devices can affect the exoskeletons efficiency, assisted subjects muscles activity and their energy expenditure when running with 2 m/s speed by using musculoskeletal simulations. We introduced new configurations of the exoskeleton for knee and knee + Hip which can provide assistance with considerably higher efficiency in comparison with monoarticular configuration which can lead the exoskeleton design to get more effective assistive devices.\\
Thanks to musculoskeletal simulations we are given insight into how energy was consumed during a gait cycle and which phase of the gait exoskeletons require more energy and where we can harvest energy to charge the battery on untethered exoskeletons and also we could show that in lower energy consumptions, actuators power profile would not be effective for regeneration. This stage of the study can further help the designer to decide about the battery and its regeneration design.
Taking advantage of the multi-criteria optimization concept to acquire the average Pareto front for each configuration enabled us to address how to compare different configurations of assistive devices while in different energy consumptions areas. This would help researchers and designers to simulate exoskeletons with their specifications such as energy consumption and torque requirement.\\

As future work, we will take into account the monoarticular and biarticular exoskeletons inertial properties which have been designed in our group to study our assistive devices effect on the running subjects energy expenditure, muscles activity and how adding inertia can affect the torque and power profiles. As it is discussed in the limitations of the study, global or dynamic optimization needs to be replaced by static optimization during the simulations which is called predictive simulation \cite{111,112} which will capture any ground reaction force, joint moment and kinematics changes and it should be one of the main future works for studying the exoskeletons effect on subjects suggested by the relevant researches \cite{2,93} as well. SCONE \cite{110} is open-source software designed for performing predictive simulations of biological motion which can be used to study the assistive devices.\\
Simulations based on the Pareto front had limitations highlighted in the previous section, which should be addressed in future work. Infeasibility of the search and big discretization can be addressed by using normal boundary intersection method \cite{108} which is designed for this purpose to resolve these issues on computationally heavy problems resulting in more accurate with lower discretization issue Pareto front for the subjects.\\
Simulations outcomes are beneficial as a prior information to assist the subjects, and they can be used on human in the loop optimization \cite{109} as a prior profile to start optimization with the simulations  torque profiles which may result in less optimization time by increasing convergence rate of the optimization; we will establish experimental setup and validate our simulations with inertial properties using experimental outcomes, then, human in the loop optimization may also examined using the simulations profiles in the next phases of this research.\\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Supporting information}

% Include only the SI item label in the paragraph heading. Use the \nameref{label} command to cite SI items in the text.
\paragraph*{S1 Appendix.}
\label{S1_Appendix}
{\bf The configuration and motion kinematics of biarticular and monoarticular exoskeletons.}

\paragraph*{S1 Fig.}
\label{S2_Fig}
{\bf Phases of subjects gait in \textit{noload} and \textit{noload} conditions.}


\section*{Acknowledgments}

\nolinenumbers

% Either type in your references using
% \begin{thebibliography}{}
% \bibitem{}
% Text
% \end{thebibliography}
%
% or
%
% Compile your BiBTeX database using our plos2015.bst
% style file and paste the contents of your .bbl file
% here. See http://journals.plos.org/plosone/s/latex for 
% step-by-step instructions.
% 
\bibliographystyle{plos2015.bst}
\bibliography{Bibliography}




\end{document}

